# ç”Ÿäº§è®¡åˆ’æ’ç¨‹ç³»ç»Ÿ - äº§å“éœ€æ±‚æ–‡æ¡£ (PRD)

> **ç‰ˆæœ¬**: v2.0
> **åˆ›å»ºæ—¥æœŸ**: 2026-01-17
> **æ›´æ–°æ—¥æœŸ**: 2026-01-17
> **ä½œè€…**: Claude AI
> **çŠ¶æ€**: å·²å®ç°

---

## 1. æ¦‚è¿°

### 1.1 é¡¹ç›®èƒŒæ™¯

æœ¬é¡¹ç›®ä¸ºä¾›åº”é“¾ç®¡ç†ç³»ç»Ÿçš„ç”Ÿäº§è®¡åˆ’æ’ç¨‹æ¨¡å—ï¼Œæä¾›å¯è§†åŒ–çš„ç”˜ç‰¹å›¾å±•ç¤ºç”Ÿäº§è®¡åˆ’æ‰§è¡Œæƒ…å†µã€‚ç³»ç»Ÿæ”¯æŒä¸¤ç§æ’ç¨‹æ¨¡å¼ï¼š

1. **é»˜è®¤æ¨¡å¼ï¼ˆæ­£æ’ï¼‰**ï¼šä»ç”Ÿäº§è®¡åˆ’å¼€å§‹æ—¶é—´å‘åæ¨ç®—ï¼Œå±•ç¤ºç‰©æ–™é‡‡è´­ã€ç»„ä»¶ç”Ÿäº§ã€äº§å“ç»„è£…çš„æ—¶é—´åˆ†å¸ƒ
2. **é½å¥—æ¨¡å¼ï¼ˆå€’æ’ï¼‰**ï¼šä»ç”Ÿäº§è®¡åˆ’ç»“æŸæ—¶é—´å‘å‰æ¨ç®—ï¼Œç¡®ä¿æ‰€æœ‰å­çº§ç‰©æ–™/ç»„ä»¶é½å¥—åæ‰å¼€å§‹ä¸Šçº§ç”Ÿäº§

### 1.2 ç›®æ ‡

- æä¾›ç›´è§‚çš„ç”Ÿäº§è®¡åˆ’ç”˜ç‰¹å›¾å¯è§†åŒ–
- æ”¯æŒä¸¤ç§æ’ç¨‹æ¨¡å¼çš„å¿«é€Ÿåˆ‡æ¢
- ä½¿ç”¨çœŸå®åç«¯æ•°æ®è®¡ç®—ç‰©æ–™/ç»„ä»¶çš„ç”Ÿäº§æ—¶é•¿
- å®æ—¶å±•ç¤ºåº“å­˜å°±ç»ªçŠ¶æ€å’Œé£é™©æç¤º
- æ”¯æŒBOMå±‚çº§çš„å±•å¼€/æ”¶ç¼©äº¤äº’

### 1.3 æœ¯è¯­å®šä¹‰

| æœ¯è¯­ | å®šä¹‰ |
|------|------|
| ç‰©æ–™ | ç‰©æ–™å¯¹è±¡ï¼Œ`material_type` ä¸º"å¤–è´­"æˆ–"å§”å¤–"ï¼Œéœ€è¦é‡‡è´­ |
| ç»„ä»¶ | ç‰©æ–™å¯¹è±¡ï¼Œ`material_type` ä¸º"è‡ªåˆ¶"ï¼Œéœ€è¦ç”Ÿäº§ |
| äº§å“ | äº§å“å¯¹è±¡ï¼Œæœ€ç»ˆæˆå“ |
| BOM | äº§å“BOMå¯¹è±¡ï¼Œå®šä¹‰çˆ¶ä»¶ä¸å­ä»¶çš„ç»„æˆå…³ç³» |
| åº“å­˜ | åº“å­˜å¯¹è±¡ï¼Œè®°å½•ç‰©æ–™çš„å®æ—¶åº“å­˜çŠ¶æ€ |
| é½å¥— | æ‰€æœ‰å­çº§ç‰©æ–™/ç»„ä»¶å…¨éƒ¨å°±ç»ªçš„çŠ¶æ€ |
| æ­£æ’ | ä»å¼€å§‹æ—¶é—´å‘åæ¨ç®—ç»“æŸæ—¶é—´çš„æ’ç¨‹æ–¹å¼ |
| å€’æ’ | ä»ç»“æŸæ—¶é—´å‘å‰æ¨ç®—å¼€å§‹æ—¶é—´çš„æ’ç¨‹æ–¹å¼ |

---

## 2. æ•°æ®æ¨¡å‹

### 2.1 æ•°æ®æºï¼ˆçŸ¥è¯†ç½‘ç»œå¯¹è±¡ï¼‰

æ ¹æ® `docs/HDä¾›åº”é“¾ä¸šåŠ¡çŸ¥è¯†ç½‘ç»œ.json`ï¼Œæ¶‰åŠä»¥ä¸‹å¯¹è±¡ï¼š

#### 2.1.1 äº§å“å¯¹è±¡ (d56v4ue9olk4bpa66v00)

| å­—æ®µå | æ˜¾ç¤ºå | ç±»å‹ | è¯´æ˜ |
|--------|--------|------|------|
| product_code | äº§å“ç¼–ç  | string | ä¸»é”® |
| product_name | äº§å“åç§° | string | æ˜¾ç¤ºå |
| assembly_time | ç”Ÿäº§ç»„è£…æ—¶é•¿ | string | **æ ¼å¼: "1000/å¤©"**ï¼Œè¡¨ç¤ºæ¯å¤©å¯ç”Ÿäº§1000ä»¶ |
| product_model | äº§å“å‹å· | string | å¯é€‰ |
| product_series | äº§å“ç³»åˆ— | string | å¯é€‰ |
| amount | æˆæœ¬é‡‘é¢ | float | å¯é€‰ |

**ç”Ÿäº§æ•ˆç‡è®¡ç®—**:
```javascript
ç”Ÿäº§æ•ˆç‡ = parseProductionRate(assembly_time)  // "1000/å¤©" â†’ 1000
ç»„è£…æ—¶é•¿ï¼ˆå¤©ï¼‰= Math.ceil(è®¡åˆ’ç”Ÿäº§æ•°é‡ / ç”Ÿäº§æ•ˆç‡)
```

#### 2.1.2 ç‰©æ–™å¯¹è±¡ (d56voju9olk4bpa66vcg)

| å­—æ®µå | æ˜¾ç¤ºå | ç±»å‹ | è¯´æ˜ |
|--------|--------|------|------|
| material_code | ç‰©æ–™ç¼–ç  | string | ä¸»é”® |
| material_name | ç‰©æ–™åç§° | string | æ˜¾ç¤ºå |
| material_type | ç‰©æ–™ç±»å‹ | string | **"å¤–è´­"/"è‡ªåˆ¶"/"å§”å¤–"** |
| delivery_duration | äº¤ä»˜æ—¶é•¿/å‘¨æœŸ | string | **æ ¼å¼: "10å¤©/æ¬¡" æˆ– "1000/å¤©"** |
| specification | è§„æ ¼å‹å· | string | å¯é€‰ |
| unit_price | å•ä»· | float | å¯é€‰ |

**ç‰©æ–™åˆ†ç±»ä¸æ—¶é•¿è®¡ç®—**:

| material_type | åˆ†ç±» | delivery_durationæ ¼å¼ | æ—¶é•¿è®¡ç®— |
|--------------|------|----------------------|---------|
| è‡ªåˆ¶ | ç»„ä»¶ | "1000/å¤©" | `Math.ceil(éœ€æ±‚æ•°é‡ / 1000)` |
| å¤–è´­ | ç‰©æ–™ | "10å¤©/æ¬¡" | å›ºå®š10å¤© |
| å§”å¤– | ç‰©æ–™ | "10å¤©/æ¬¡" | å›ºå®š10å¤© |

#### 2.1.3 åº“å­˜å¯¹è±¡ (d56vcuu9olk4bpa66v3g)

| å­—æ®µå | æ˜¾ç¤ºå | ç±»å‹ | è¯´æ˜ |
|--------|--------|------|------|
| material_code | ç‰©æ–™ç¼–ç  | string | ä¸»é”® |
| material_name | ç‰©æ–™åç§° | string | æ˜¾ç¤ºå |
| inventory_data | åº“å­˜æ•°é‡ | float | å½“å‰åº“å­˜æ€»é‡ |
| available_quantity | å¯ç”¨æ•°é‡ | float | **ä¼˜å…ˆä½¿ç”¨** |
| safety_stock | å®‰å…¨åº“å­˜ | integer | å®‰å…¨åº“å­˜è­¦æˆ’çº¿ |
| inventory_age | åº“é¾„ | integer | å¤©æ•° |

**åº“å­˜åˆ¤æ–­**:
```javascript
å¯ç”¨åº“å­˜ = available_quantity || inventory_data || 0
æ˜¯å¦å°±ç»ª = å¯ç”¨åº“å­˜ >= éœ€æ±‚æ•°é‡
```

#### 2.1.4 äº§å“BOMå¯¹è±¡ (d56vqtm9olk4bpa66vfg)

| å­—æ®µå | æ˜¾ç¤ºå | ç±»å‹ | è¯´æ˜ |
|--------|--------|------|------|
| bom_number | BOMç¼–å· | string | ä¸»é”® |
| parent_code | çˆ¶ä»¶ç¼–ç  | string | ä¸Šçº§ç‰©æ–™/äº§å“ç¼–ç  |
| parent_name | çˆ¶ä»¶åç§° | string | ä¸Šçº§ç‰©æ–™/äº§å“åç§° |
| child_code | å­ä»¶ç¼–ç  | string | ä¸‹çº§ç‰©æ–™/ç»„ä»¶ç¼–ç  |
| child_name | å­ä»¶åç§° | string | ä¸‹çº§ç‰©æ–™/ç»„ä»¶åç§° |
| child_quantity | å­ä»¶ç”¨é‡ | float | ç”Ÿäº§ä¸€ä¸ªçˆ¶ä»¶æ‰€éœ€æ•°é‡ |
| loss_rate | æŸè€—ç‡ | integer | **ç™¾åˆ†æ¯”**ï¼Œå¦‚5è¡¨ç¤º5% |
| alternative_group | æ›¿ä»£ç»„ | float | æ›¿ä»£ç‰©æ–™åˆ†ç»„ç¼–å· |
| alternative_part | æ›¿ä»£æ ‡è¯† | string | "æ›¿ä»£"è¡¨ç¤ºæ›¿ä»£ç‰©æ–™ï¼ˆéœ€è¿‡æ»¤ï¼‰ |
| unit | å•ä½ | string | è®¡é‡å•ä½ |

**éœ€æ±‚æ•°é‡è®¡ç®—**:
```javascript
// æŸè€—ç‡å½’ä¸€åŒ–
effectiveLossRate = loss_rate > 1 ? loss_rate / 100 : loss_rate

// éœ€æ±‚æ•°é‡ = (ä¸Šçº§è®¡åˆ’æ•°é‡ * å­ä»¶ç”¨é‡) / (1 - æŸè€—ç‡)
éœ€æ±‚æ•°é‡ = Math.ceil((parentQuantity * child_quantity) / (1 - effectiveLossRate))
```

#### 2.1.5 å·¥å‚ç”Ÿäº§è®¡åˆ’å¯¹è±¡ (d5704qm9olk4bpa66vp0)

| å­—æ®µå | æ˜¾ç¤ºå | ç±»å‹ | è¯´æ˜ |
|--------|--------|------|------|
| order_number | è®¡åˆ’ç”Ÿäº§ç¼–å· | string | ä¸»é”® |
| code | äº§å“ç¼–ç  | string | å…³è”äº§å“ |
| quantity | è®¡åˆ’ç”Ÿäº§æ•°é‡ | integer | ç”Ÿäº§æ•°é‡ |
| start_time | å¼€å§‹æ—¶é—´ | date | **è®¡åˆ’å¼€å§‹æ—¶é—´** |
| end_time | ç»“æŸæ—¶é—´ | date | **è®¡åˆ’ç»“æŸæ—¶é—´** |
| status | çŠ¶æ€ | string | æœªå¼€å§‹/è¿›è¡Œä¸­/å·²å®Œæˆ |
| priority | ä¼˜å…ˆçº§ | integer | æ•°å€¼è¶Šå°ä¼˜å…ˆçº§è¶Šé«˜ |
| ordered | å·²ä¸‹å•æ•°é‡ | integer | å·²ä¸‹è¾¾ç”Ÿäº§æŒ‡ä»¤æ•°é‡ |

---

## 3. åŠŸèƒ½éœ€æ±‚

### 3.1 æ¨¡å¼åˆ‡æ¢ (FR-001)

**æè¿°**: ç”¨æˆ·å¯ä»¥åœ¨ä¸¤ç§æ’ç¨‹æ¨¡å¼ä¹‹é—´åˆ‡æ¢

**æ¨¡å¼é€‰é¡¹**:
| æ¨¡å¼ | è¯´æ˜ | æ’ç¨‹æ–¹å‘ |
|------|------|---------|
| é»˜è®¤æ¨¡å¼ | å¿«é€Ÿé¢„è§ˆï¼Œä»è®¡åˆ’å¼€å§‹æ—¶é—´å‘åæ¨ç®— | æ­£æ’ |
| é½å¥—æ¨¡å¼ | å€’æ’æ’ç¨‹ï¼Œä»è®¡åˆ’ç»“æŸæ—¶é—´å‘å‰æ¨ç®—ï¼ˆæ¨èï¼‰ | å€’æ’ |

**UIä½ç½®**: äº§å“ä¿¡æ¯é¢æ¿ä¸‹æ–¹ï¼Œç‹¬ç«‹å¡ç‰‡å±•ç¤º

**äº¤äº’**:
- ç‚¹å‡»æ¨¡å¼æŒ‰é’®åˆ‡æ¢
- åˆ‡æ¢æ—¶è‡ªåŠ¨é‡æ–°è®¡ç®—å¹¶æ¸²æŸ“ç”˜ç‰¹å›¾
- åŠ è½½æ—¶ç¦ç”¨åˆ‡æ¢æŒ‰é’®

### 3.2 é»˜è®¤æ¨¡å¼ç®—æ³• (FR-002)

**æ­£æ’æ’ç¨‹åŸåˆ™**: ä»ç”Ÿäº§è®¡åˆ’å¼€å§‹æ—¶é—´å‘åæ¨ç®—

```
æ—¶é—´è½´ â†’
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è®¡åˆ’å¼€å§‹                                                    è®¡åˆ’ç»“æŸ    â”‚
â”‚     â†“                                                          â†“       â”‚
â”‚  ç‰©æ–™å±‚  â”‚â– â– â– â– â– â”‚                                                        â”‚
â”‚          â”‚ ç‰©æ–™A â”‚                                                       â”‚
â”‚          â”‚é‡‡è´­10å¤©â”‚                                                       â”‚
â”‚          â”‚       â”‚â– â– â– â– â– â– â”‚                                               â”‚
â”‚          â”‚       â”‚ ç‰©æ–™B â”‚                                               â”‚
â”‚          â”‚       â”‚é‡‡è´­15å¤©â”‚                                               â”‚
â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”˜                                              â”‚
â”‚  ç»„ä»¶å±‚  â”‚               â”‚â– â– â– â– â– â– â”‚                                       â”‚
â”‚          â”‚               â”‚ ç»„ä»¶C â”‚                                       â”‚
â”‚          â”‚               â”‚ç”Ÿäº§5å¤© â”‚                                       â”‚
â”‚          â”‚               â””â”€â”€â”€â”€â”€â”€â”€â”˜                                       â”‚
â”‚  äº§å“å±‚  â”‚                       â”‚â– â– â– â– â– â– â– â”‚                              â”‚
â”‚          â”‚                       â”‚  äº§å“  â”‚                              â”‚
â”‚          â”‚                       â”‚ç»„è£…3å¤©  â”‚                              â”‚
â”‚          â”‚                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ç®—æ³•æ­¥éª¤**:

1. **ç¡®å®šèµ·å§‹æ—¶é—´**: ä»ç”Ÿäº§è®¡åˆ’çš„ `start_time` å¼€å§‹

2. **ç‰©æ–™/ç»„ä»¶å¹¶è¡Œå¯åŠ¨**:
   ```
   ç‰©æ–™/ç»„ä»¶å¼€å§‹æ—¶é—´ = è®¡åˆ’å¼€å§‹æ—¶é—´
   ç‰©æ–™/ç»„ä»¶ç»“æŸæ—¶é—´ = å¼€å§‹æ—¶é—´ + æ—¶é•¿
   ```

3. **è®¡ç®—ç‰©æ–™/ç»„ä»¶æ—¶é•¿**:
   ```javascript
   if (åº“å­˜å……è¶³) {
     æ—¶é•¿ = 1å¤©  // å·²å°±ç»ª
   } else {
     if (material_type === 'è‡ªåˆ¶') {
       æ—¶é•¿ = Math.ceil(éœ€æ±‚æ•°é‡ / ç”Ÿäº§æ•ˆç‡)
     } else {
       æ—¶é•¿ = äº¤ä»˜å‘¨æœŸå¤©æ•°
     }
   }
   ```

4. **ç»„ä»¶ç­‰å¾…é½å¥—**:
   ```
   çˆ¶çº§å¼€å§‹æ—¶é—´ = æ‰€æœ‰å­çº§å®Œæˆçš„æœ€æ™šæ—¶é—´
   ```

5. **äº§å“ç»„è£…**:
   ```
   äº§å“å¼€å§‹æ—¶é—´ = æ‰€æœ‰ä¸€çº§å­çº§å®Œæˆçš„æœ€æ™šæ—¶é—´
   äº§å“ç»“æŸæ—¶é—´ = äº§å“å¼€å§‹æ—¶é—´ + ç»„è£…æ—¶é•¿
   ```

6. **åˆ¤æ–­æ˜¯å¦è¶…æœŸ**:
   ```
   isOverdue = äº§å“ç»“æŸæ—¶é—´ > è®¡åˆ’ç»“æŸæ—¶é—´
   overdueDays = (äº§å“ç»“æŸæ—¶é—´ - è®¡åˆ’ç»“æŸæ—¶é—´) / å¤©
   ```

### 3.3 é½å¥—æ¨¡å¼ç®—æ³• (FR-003)

**å€’æ’æ’ç¨‹åŸåˆ™**: ä»ç”Ÿäº§è®¡åˆ’ç»“æŸæ—¶é—´å‘å‰æ¨ç®—

```
æ—¶é—´è½´ â†’
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è®¡åˆ’å¼€å§‹                                                    è®¡åˆ’ç»“æŸ    â”‚
â”‚     â†“                                                          â†“       â”‚
â”‚  ç‰©æ–™å±‚  â”‚â– â– â– â– â– â”‚                                                        â”‚
â”‚          â”‚ ç‰©æ–™A â”‚                                                       â”‚
â”‚          â”‚é‡‡è´­10å¤©â”‚                                                       â”‚
â”‚          â”‚       â”‚â– â– â– â– â– â– â”‚                                               â”‚
â”‚          â”‚       â”‚ ç‰©æ–™B â”‚                                               â”‚
â”‚          â”‚       â”‚é‡‡è´­15å¤©â”‚                                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ç»„ä»¶å±‚  â”‚               â”‚â– â– â– â– â– â– â”‚                                       â”‚
â”‚          â”‚               â”‚ ç»„ä»¶C â”‚                                       â”‚
â”‚          â”‚               â”‚ç”Ÿäº§5å¤© â”‚                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  äº§å“å±‚  â”‚                       â”‚â– â– â– â– â– â– â– â”‚                              â”‚
â”‚          â”‚                       â”‚  äº§å“  â”‚ â† å¿…é¡»åœ¨æ­¤ç»“æŸ               â”‚
â”‚          â”‚                       â”‚ç»„è£…3å¤©  â”‚                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                          â†‘ è®¡åˆ’ç»“æŸæ—¶é—´                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ç®—æ³•æ­¥éª¤**:

1. **ç¡®å®šäº§å“ç»“æŸæ—¶é—´**: äº§å“ç»“æŸæ—¶é—´ = ç”Ÿäº§è®¡åˆ’ç»“æŸæ—¶é—´ (`end_time`)

2. **è®¡ç®—äº§å“ç»„è£…å¼€å§‹æ—¶é—´**:
   ```
   äº§å“ç»„è£…æ—¶é•¿ = Math.ceil(è®¡åˆ’ç”Ÿäº§æ•°é‡ / äº§å“ç”Ÿäº§æ•ˆç‡)
   äº§å“å¼€å§‹æ—¶é—´ = äº§å“ç»“æŸæ—¶é—´ - äº§å“ç»„è£…æ—¶é•¿
   ```

3. **é€å±‚çº§å€’æ¨**:
   ```
   æ¯ä¸€çº§å¯¹è±¡çš„ç»“æŸæ—¶é—´ = ä¸Šä¸€çº§çš„å¼€å§‹æ—¶é—´ - 1å¤©
   æ¯ä¸€çº§å¯¹è±¡çš„å¼€å§‹æ—¶é—´ = ç»“æŸæ—¶é—´ - è¯¥å¯¹è±¡çš„ç»„è£…/äº¤ä»˜æ—¶é•¿
   ```

4. **å¤„ç†åº“å­˜å°±ç»ªæƒ…å†µ**:
   ```javascript
   if (å¯ç”¨åº“å­˜ >= éœ€æ±‚æ•°é‡) {
     // å·²å°±ç»ªï¼Œç”¨1å¤©è¡¨ç¤º
     å¼€å§‹æ—¶é—´ = ç»“æŸæ—¶é—´ - 1
     çŠ¶æ€ = "å°±ç»ª"ï¼ˆç»¿è‰²ï¼‰
   } else {
     // æœªå°±ç»ªï¼Œéœ€è¦é‡‡è´­/ç”Ÿäº§
     çŠ¶æ€ = "æœªå°±ç»ª"ï¼ˆé»„è‰²ï¼‰
   }
   ```

5. **æ—¶é—´è°ƒæ•´**:
   ```javascript
   // è®¡ç®—æœ€åº•å±‚ç‰©æ–™çš„å®é™…å¼€å§‹æ—¶é—´
   actualStartTime = æœ€åº•å±‚ç‰©æ–™çš„å¼€å§‹æ—¶é—´
   planStartTime = ç”Ÿäº§è®¡åˆ’å¼€å§‹æ—¶é—´

   if (actualStartTime < planStartTime) {
     // æ— æ³•æŒ‰æ—¶å®Œæˆï¼Œæ‰€æœ‰å¯¹è±¡å‘åè°ƒæ•´
     adjustDays = planStartTime - actualStartTime
     æ‰€æœ‰å¯¹è±¡çš„å¼€å§‹/ç»“æŸæ—¶é—´ += adjustDays
     // æ ‡è®°ä¸ºè¶…æœŸ
   } else if (actualStartTime > planStartTime) {
     // å¯ä»¥æå‰å®Œæˆï¼Œæ‰€æœ‰å¯¹è±¡å‘å‰è°ƒæ•´
     adjustDays = actualStartTime - planStartTime
     æ‰€æœ‰å¯¹è±¡çš„å¼€å§‹/ç»“æŸæ—¶é—´ -= adjustDays
   }
   ```

### 3.4 ä¸¤ç§æ¨¡å¼å¯¹æ¯”

| ç‰¹æ€§ | é»˜è®¤æ¨¡å¼ï¼ˆæ­£æ’ï¼‰ | é½å¥—æ¨¡å¼ï¼ˆå€’æ’ï¼‰ |
|------|-----------------|-----------------|
| **æ’ç¨‹èµ·ç‚¹** | ç”Ÿäº§è®¡åˆ’ `start_time` | ç”Ÿäº§è®¡åˆ’ `end_time` |
| **æ’ç¨‹æ–¹å‘** | ä»å¼€å§‹å‘åæ¨ç®— | ä»ç»“æŸå‘å‰æ¨ç®— |
| **æ—¶é—´åˆ†å¸ƒ** | ç‰©æ–™â†’ç»„ä»¶â†’äº§å“ï¼ˆé¡ºåºï¼‰ | äº§å“â†ç»„ä»¶â†ç‰©æ–™ï¼ˆé€†åºï¼‰ |
| **é€‚ç”¨åœºæ™¯** | æŸ¥çœ‹ä»å¼€å§‹åˆ°ç»“æŸçš„æ—¶é—´åˆ†å¸ƒ | ç¡®ä¿æŒ‰æ—¶äº¤ä»˜ï¼Œè¯†åˆ«å»¶æœŸé£é™© |
| **å­çº§å…³ç³»** | å¹¶è¡Œå¯åŠ¨ï¼Œç­‰å¾…é½å¥—åå¼€å§‹ä¸‹ä¸€çº§ | å­çº§ç»“æŸæ—¶é—´ = çˆ¶çº§å¼€å§‹æ—¶é—´ - 1å¤© |
| **è¶…æœŸåˆ¤æ–­** | äº§å“ç»“æŸæ—¶é—´ > è®¡åˆ’ç»“æŸæ—¶é—´ | å®é™…å¼€å§‹æ—¶é—´ < è®¡åˆ’å¼€å§‹æ—¶é—´ |

### 3.5 BOMå±‚çº§å±•å¼€ (FR-004)

**æè¿°**: ç”˜ç‰¹å›¾æ”¯æŒBOMæ ‘å½¢ç»“æ„çš„å±•å¼€/æ”¶ç¼©

**è§„åˆ™**:
- é»˜è®¤å±•å¼€äº§å“ä¸€çº§ï¼Œæ˜¾ç¤ºä¸€çº§ç»„ä»¶/ç‰©æ–™
- ç‚¹å‡»å±•å¼€å›¾æ ‡å¯ä»¥å±•å¼€ä¸‹ä¸€çº§
- æ”¯æŒæ— é™å±‚çº§ï¼ˆé€’å½’å±•å¼€ï¼‰
- **å¿½ç•¥æ›¿ä»£ç‰©æ–™** (`alternative_part = "æ›¿ä»£"`)

**äº¤äº’**:
- ç‚¹å‡»è¡Œé¦–çš„ â–¶/â–¼ å›¾æ ‡åˆ‡æ¢å±•å¼€çŠ¶æ€
- å±•å¼€æ—¶æ˜¾ç¤ºå­çº§ï¼Œæ”¶ç¼©æ—¶éšè—å­çº§

### 3.6 ç”˜ç‰¹å›¾é¡¶éƒ¨ä¿¡æ¯æ  (FR-005)

**æ˜¾ç¤ºå†…å®¹**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [P] äº§å“: T01-000055-åŒ—æ–—è½¦è½½æ™ºèƒ½ç»ˆç«¯ç³»ç»Ÿ                                â”‚
â”‚                                                                         â”‚
â”‚ é¢„è®¡å‡ºè´§å‘¨æœŸ: 01/01 ~ 03/30    å®é™…æ—¶é—´: 01/01 ~ 02/21                   â”‚
â”‚ çŠ¶æ€: æå‰37å¤©                 æ€»å‘¨æœŸ: 51å¤©                              â”‚
â”‚                                                                         â”‚
â”‚ è®¡åˆ’æ—¶é—´: 2026-01-01 ~ 2026-03-30                                       â”‚
â”‚ å®é™…æ—¶é—´: 2026-01-01 ~ 2026-02-21                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å­—æ®µè¯´æ˜**:
| å­—æ®µ | è¯´æ˜ |
|------|------|
| äº§å“ | `${product_code}-${product_name}` |
| é¢„è®¡å‡ºè´§å‘¨æœŸ | ç”Ÿäº§è®¡åˆ’çš„ `start_time ~ end_time` |
| å®é™…æ—¶é—´ | è®¡ç®—å‡ºçš„ `actual_start_time ~ actual_end_time` |
| çŠ¶æ€ | å»¶æœŸXå¤©ï¼ˆçº¢è‰²ï¼‰/ æå‰Xå¤©ï¼ˆç»¿è‰²ï¼‰/ æŒ‰æ—¶å®Œæˆï¼ˆè“è‰²ï¼‰ |
| æ€»å‘¨æœŸ | å®é™…ç»“æŸæ—¶é—´ - å®é™…å¼€å§‹æ—¶é—´ï¼ˆå¤©ï¼‰ |

### 3.7 è¿›åº¦æ¡ä¸Tooltip (FR-006)

#### 3.7.1 äº§å“è¿›åº¦æ¡Tooltip

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ T01-000055-åŒ—æ–—è½¦è½½æ™ºèƒ½ç»ˆç«¯ç³»ç»Ÿ               â”‚
â”‚ ç±»å‹: äº§å“                                    â”‚
â”‚ è®¡åˆ’ç”Ÿäº§æ•°é‡: 5000                            â”‚
â”‚ ç”Ÿäº§æ•ˆç‡: 1000/å¤©                             â”‚
â”‚ ç»„è£…æ—¶é•¿: 5å¤©                                 â”‚
â”‚ æ—¶é—´: 2026-02-16 ~ 2026-02-21                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 3.7.2 ç»„ä»¶è¿›åº¦æ¡Tooltipï¼ˆè‡ªåˆ¶ç‰©æ–™ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ M001-ä¸»æ§æ¿ç»„ä»¶                               â”‚
â”‚ ç±»å‹: ç»„ä»¶ï¼ˆè‡ªåˆ¶ï¼‰                            â”‚
â”‚ éœ€æ±‚æ•°é‡: 5263                                â”‚
â”‚ åº“å­˜æ•°é‡: 1000                                â”‚
â”‚ ç”Ÿäº§æ•ˆç‡: 1000/å¤©                             â”‚
â”‚ ç”Ÿäº§æ—¶é•¿: 6å¤©                                 â”‚
â”‚ æ—¶é—´: 2026-02-10 ~ 2026-02-15                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 3.7.3 ç‰©æ–™è¿›åº¦æ¡Tooltipï¼ˆå¤–è´­/å§”å¤–ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ R001-ç”µé˜»10K                                  â”‚
â”‚ ç±»å‹: ç‰©æ–™ï¼ˆå¤–è´­ï¼‰                            â”‚
â”‚ éœ€æ±‚æ•°é‡: 26316                               â”‚
â”‚ åº“å­˜æ•°é‡: 30000 âœ“ å……è¶³                        â”‚
â”‚ äº¤ä»˜å‘¨æœŸ: 10å¤©                                â”‚
â”‚ æ—¶é—´: 2026-01-01 ~ 2026-01-01 (å·²å°±ç»ª)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.8 é¢œè‰²ç¼–ç  (FR-007)

| çŠ¶æ€ | é¢œè‰² | è‰²å€¼ | è¯´æ˜ |
|------|------|------|------|
| å°±ç»ªï¼ˆåº“å­˜å……è¶³ï¼‰ | ç»¿è‰² | `#22C55E` | åº“å­˜ >= éœ€æ±‚ï¼Œè¿›åº¦æ¡æ˜¾ç¤º1å¤© |
| æœªå°±ç»ªï¼ˆéœ€é‡‡è´­/ç”Ÿäº§ï¼‰ | é»„è‰² | `#EAB308` | åº“å­˜ < éœ€æ±‚ï¼Œéœ€è¦æ—¶é—´å‡†å¤‡ |
| è¶…æœŸï¼ˆè¶…å‡ºè®¡åˆ’ç»“æŸæ—¶é—´ï¼‰ | çº¢è‰² | `#EF4444` | å®é™…ç»“æŸæ—¶é—´ > è®¡åˆ’ç»“æŸæ—¶é—´ |
| æ­£å¸¸ï¼ˆäº§å“ï¼‰ | è“è‰² | `#3B82F6` | äº§å“é»˜è®¤é¢œè‰² |

### 3.9 é£é™©æç¤º (FR-008)

**æ˜¾ç¤ºæ¡ä»¶**: å½“å­˜åœ¨ä»¥ä¸‹é£é™©æ—¶æ˜¾ç¤º

| é£é™©ç±»å‹ | çº§åˆ« | ç¤ºä¾‹æ¶ˆæ¯ |
|---------|------|---------|
| åº“å­˜ä¸è¶³ | warning | ç‰©æ–™ R001-ç”µé˜»10K åº“å­˜ä¸è¶³ï¼Œç¼ºå£5316ï¼Œéœ€10å¤©é‡‡è´­ |
| åº“å­˜ä¸º0 | critical | ç»„ä»¶ M001-ä¸»æ§æ¿ åº“å­˜ä¸º0ï¼Œéœ€6å¤©ç”Ÿäº§ |
| è®¡åˆ’è¶…æœŸ | critical | ç”Ÿäº§è®¡åˆ’é¢„è®¡å»¶æœŸ 5 å¤©ï¼Œå®é™…ç»“æŸæ—¶é—´ 2026-04-05 |

**AIå»ºè®®**: æ¯æ¡é£é™©æç¤ºé™„å¸¦æ™ºèƒ½å»ºè®®
- å»ºè®®æå‰å®‰æ’ç”Ÿäº§ï¼Œå½“å‰åº“å­˜Xï¼Œéœ€æ±‚Y
- å»ºè®®ç«‹å³å¯åŠ¨é‡‡è´­æµç¨‹ï¼Œè€ƒè™‘å¤‡ç”¨ä¾›åº”å•†
- å»ºè®®ï¼š1) åŠ æ€¥é‡‡è´­ç¼ºè´§ç‰©æ–™ï¼›2) å¢åŠ ç”Ÿäº§ç­æ¬¡ï¼›3) å¯»æ‰¾æ›¿ä»£ä¾›åº”å•†

---

## 4. æ¥å£è®¾è®¡

### 4.1 æ•°æ®è·å–å‡½æ•°

```typescript
// è·å–å®Œæ•´æ•°æ®ï¼ˆäº§å“ä¿¡æ¯ã€ç”Ÿäº§è®¡åˆ’ã€BOMã€ç‰©æ–™è¯¦æƒ…ã€åº“å­˜ï¼‰
async function fetchMaterialReadyV2Data(productCode: string): Promise<{
  product: ProductExtendedInfo | null;
  productionPlan: ProductionPlan | null;
  bomItems: BOMItem[];
  materialDetails: Map<string, MaterialInfo>;
  inventoryMap: Map<string, number>;
}>

// è§£æäº¤ä»˜æ—¶é•¿å­—ç¬¦ä¸²
function parseDeliveryDuration(durationStr: string): {
  type: 'duration' | 'rate';
  value: number;
}
// "10å¤©/æ¬¡" â†’ { type: 'duration', value: 10 }
// "1000/å¤©" â†’ { type: 'rate', value: 1000 }

// è§£æäº§å“ç»„è£…æ—¶é•¿
function parseProductionRate(assemblyTimeStr: string): number
// "1000/å¤©" â†’ 1000
```

### 4.2 è®¡ç®—å‡½æ•°

```typescript
// é»˜è®¤æ¨¡å¼è®¡ç®—ï¼ˆæ­£æ’ï¼‰
function calculateDefaultMode(
  product: ProductExtendedInfo,
  productionPlan: ProductionPlan,
  bomItems: BOMItem[],
  materialDetails: Map<string, MaterialInfo>,
  inventoryMap: Map<string, number>
): DefaultModeCalculationResult

// é½å¥—æ¨¡å¼è®¡ç®—ï¼ˆå€’æ’ï¼‰
function calculateMaterialReadyModeV2(
  product: ProductExtendedInfo,
  productionPlan: ProductionPlan,
  bomItems: BOMItem[],
  materialDetails: Map<string, MaterialInfo>,
  inventoryMap: Map<string, number>
): MaterialReadyCalculationResult
```

### 4.3 æ•°æ®ç»“æ„

```typescript
// ç”Ÿäº§è®¡åˆ’æ¨¡å¼ç±»å‹
type ProductionPlanMode = 'default' | 'material-ready-v2';

// ç”˜ç‰¹å›¾ä»»åŠ¡ï¼ˆé€šç”¨ï¼‰
interface GanttTask {
  id: string;
  name: string;
  type: 'product' | 'module' | 'component' | 'material';
  level: number;
  startDate: Date;
  endDate: Date;
  duration: number;
  status: 'normal' | 'warning' | 'critical';
  children?: GanttTask[];
}

// é½å¥—æ¨¡å¼ç”˜ç‰¹ä»»åŠ¡ï¼ˆæ‰©å±•ï¼‰
interface MaterialReadyGanttTask extends Omit<GanttTask, 'status'> {
  code: string;
  status: 'ready' | 'not-ready' | 'overdue' | 'normal';
  isReady: boolean;
  requiredQuantity: number;
  availableInventory: number;
  productionRate?: number;
  deliveryDuration?: number;
  assemblyTime?: number;
  materialType?: 'è‡ªåˆ¶' | 'å¤–è´­' | 'å§”å¤–';
  lossRate?: number;
  childQuantity?: number;
  isExpanded: boolean;
  canExpand: boolean;
  parentId?: string;
}

// è®¡ç®—ç»“æœï¼ˆä¸¤ç§æ¨¡å¼å…±ç”¨ï¼‰
interface CalculationResult {
  tasks: GanttTask[] | MaterialReadyGanttTask[];
  totalCycle: number;
  planStartDate: Date;
  planEndDate: Date;
  actualStartDate: Date;
  actualEndDate: Date;
  isOverdue: boolean;
  overdueDays: number;  // æ­£æ•°=å»¶æœŸï¼Œè´Ÿæ•°=æå‰
  risks: RiskAlert[];
}

// é£é™©æç¤º
interface RiskAlert {
  type: 'material_shortage' | 'schedule_overdue' | 'material_delay';
  level: 'warning' | 'critical';
  message: string;
  itemId: string;
  itemName: string;
  aiSuggestion?: string;
}
```

---

## 5. UIè®¾è®¡

### 5.1 é¡µé¢å¸ƒå±€

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [äº§å“é€‰æ‹©å™¨ â–¼]                                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ äº§å“ä¿¡æ¯é¢æ¿                                                             â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ åº“å­˜: 1000  å®‰å…¨åº“å­˜: 500  æœˆäº§èƒ½: 2500  åœ¨æ‰‹è®¢å•: 3000  è®¡åˆ’: 5000   â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ è®¡åˆ’æ¨¡å¼é€‰æ‹©å™¨                                                           â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ è®¡åˆ’æ¨¡å¼:  [é»˜è®¤æ¨¡å¼]  [é½å¥—æ¨¡å¼ æ¨è]                                â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ é¡¶éƒ¨ä¿¡æ¯æ  (GanttHeader)                                                 â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ [P] äº§å“: T01-000055-åŒ—æ–—è½¦è½½æ™ºèƒ½ç»ˆç«¯                                â”‚ â”‚
â”‚ â”‚ é¢„è®¡: 01/01~03/30  å®é™…: 01/01~02/21  çŠ¶æ€: æå‰37å¤©  æ€»å‘¨æœŸ: 51å¤©   â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ç”˜ç‰¹å›¾åŒºåŸŸ                                                               â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ åç§°          â”‚ 01/01  01/15  02/01  02/15  03/01  03/15  03/30    â”‚ â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚ â”‚â–¼ T01-ç»ˆç«¯     â”‚                              [=====äº§å“=====]       â”‚ â”‚
â”‚ â”‚  â–¶ M001-ä¸»æ§æ¿â”‚                         [===ç»„ä»¶===]                â”‚ â”‚
â”‚ â”‚  â–¶ M002-å¤–å£³  â”‚                         [==]                       â”‚ â”‚
â”‚ â”‚  â— R001-ç”µé˜»  â”‚ [â– ]                                                â”‚ â”‚
â”‚ â”‚  â— R002-ç”µå®¹  â”‚ [â– â– â– â– â– ]                                            â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚ å›¾ä¾‹: [ç»¿è‰²]=å°±ç»ª  [é»„è‰²]=æœªå°±ç»ª  [çº¢è‰²]=è¶…æœŸ  [è“è‰²]=äº§å“               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ é£é™©æç¤ºé¢æ¿                                                             â”‚
â”‚ âš  ç‰©æ–™R002-ç”µå®¹åº“å­˜ä¸è¶³ï¼Œç¼ºå£5316ï¼Œéœ€10å¤©é‡‡è´­                            â”‚
â”‚ ğŸ’¡ å»ºè®®ç«‹å³å¯åŠ¨é‡‡è´­æµç¨‹ï¼Œè€ƒè™‘å¤‡ç”¨ä¾›åº”å•†                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2 ç»„ä»¶ç»“æ„

```
MPSPrototype
â”œâ”€â”€ ProductSelector              // äº§å“é€‰æ‹©å™¨
â”œâ”€â”€ ProductInfoPanel             // äº§å“ä¿¡æ¯é¢æ¿
â”œâ”€â”€ PlanModeSelector             // è®¡åˆ’æ¨¡å¼é€‰æ‹©å™¨
â”‚   â””â”€â”€ é»˜è®¤æ¨¡å¼ | é½å¥—æ¨¡å¼
â”œâ”€â”€ GanttHeader                  // é¡¶éƒ¨ä¿¡æ¯æ 
â”‚   â””â”€â”€ äº§å“ä¿¡æ¯ã€è®¡åˆ’æ—¶é—´ã€å®é™…æ—¶é—´ã€çŠ¶æ€ã€æ€»å‘¨æœŸ
â”œâ”€â”€ GanttChartSection            // ç”˜ç‰¹å›¾åŒºåŸŸ
â”‚   â”œâ”€â”€ GanttBOMTree             // BOMæ ‘å½¢ç»“æ„
â”‚   â”‚   â””â”€â”€ TreeNode (é€’å½’)
â”‚   â”‚       â””â”€â”€ GanttTaskBar     // è¿›åº¦æ¡
â”‚   â”œâ”€â”€ GanttTooltip             // æ‚¬æµ®æç¤º
â”‚   â””â”€â”€ LegendPanel              // é¢œè‰²å›¾ä¾‹
â””â”€â”€ RiskAlertsPanel              // é£é™©æç¤ºé¢æ¿ï¼ˆå†…è”ï¼‰
```

---

## 6. å®ç°çŠ¶æ€

### 6.1 å·²å®Œæˆæ–‡ä»¶æ¸…å•

| æ–‡ä»¶ | è¯´æ˜ | çŠ¶æ€ |
|------|------|------|
| `src/types/ontology.ts` | ç±»å‹å®šä¹‰ | âœ… å·²å®Œæˆ |
| `src/services/mpsDataService.ts` | æ•°æ®è·å–æœåŠ¡ | âœ… å·²å®Œæˆ |
| `src/utils/defaultModeCalculator.ts` | é»˜è®¤æ¨¡å¼ç®—æ³•ï¼ˆæ­£æ’ï¼‰ | âœ… å·²å®Œæˆ |
| `src/utils/materialReadyCalculatorV2.ts` | é½å¥—æ¨¡å¼ç®—æ³•ï¼ˆå€’æ’ï¼‰ | âœ… å·²å®Œæˆ |
| `src/components/planning/PlanModeSelector.tsx` | æ¨¡å¼é€‰æ‹©å™¨ | âœ… å·²å®Œæˆ |
| `src/components/planning/GanttHeader.tsx` | é¡¶éƒ¨ä¿¡æ¯æ  | âœ… å·²å®Œæˆ |
| `src/components/planning/GanttTaskBar.tsx` | è¿›åº¦æ¡ç»„ä»¶ | âœ… å·²å®Œæˆ |
| `src/components/planning/GanttTooltip.tsx` | æ‚¬æµ®æç¤º | âœ… å·²å®Œæˆ |
| `src/components/planning/GanttBOMTree.tsx` | BOMæ ‘å½¢ç»„ä»¶ | âœ… å·²å®Œæˆ |
| `src/components/planning/GanttChartSection.tsx` | ç”˜ç‰¹å›¾åŒºåŸŸ | âœ… å·²å®Œæˆ |
| `src/components/planning/LegendPanel.tsx` | é¢œè‰²å›¾ä¾‹ | âœ… å·²å®Œæˆ |
| `src/components/planning/MPSPrototype.tsx` | ä¸»ç»„ä»¶ | âœ… å·²å®Œæˆ |

### 6.2 æ ¸å¿ƒå‡½æ•°å®ç°

#### 6.2.1 æ•°æ®è§£æå‡½æ•°

```typescript
// src/services/mpsDataService.ts

// è§£æäº¤ä»˜æ—¶é•¿
export function parseDeliveryDuration(durationStr: string): {
  type: 'duration' | 'rate';
  value: number;
} {
  // "10å¤©/æ¬¡" â†’ { type: 'duration', value: 10 }
  // "1000/å¤©" â†’ { type: 'rate', value: 1000 }
}

// è§£æäº§å“ç”Ÿäº§æ•ˆç‡
export function parseProductionRate(assemblyTimeStr: string): number {
  // "1000/å¤©" â†’ 1000
}

// è®¡ç®—æ—¶é•¿
export function calculateDuration(
  quantity: number,
  deliveryDuration: string,
  materialType: 'è‡ªåˆ¶' | 'å¤–è´­' | 'å§”å¤–'
): number {
  // è‡ªåˆ¶: Math.ceil(quantity / rate)
  // å¤–è´­/å§”å¤–: å›ºå®šå¤©æ•°
}
```

#### 6.2.2 é»˜è®¤æ¨¡å¼è®¡ç®—ï¼ˆæ­£æ’ï¼‰

```typescript
// src/utils/defaultModeCalculator.ts

export function calculateDefaultMode(...): DefaultModeCalculationResult {
  // 1. ä» planStartDate å¼€å§‹
  // 2. ç‰©æ–™/ç»„ä»¶å¹¶è¡Œå¯åŠ¨
  // 3. çˆ¶çº§ç­‰å¾…æ‰€æœ‰å­çº§å®Œæˆ
  // 4. äº§å“åœ¨æœ€åç»„è£…
  // 5. åˆ¤æ–­æ˜¯å¦è¶…è¿‡ planEndDate
}
```

#### 6.2.3 é½å¥—æ¨¡å¼è®¡ç®—ï¼ˆå€’æ’ï¼‰

```typescript
// src/utils/materialReadyCalculatorV2.ts

export function calculateMaterialReadyModeV2(...): MaterialReadyCalculationResult {
  // 1. ä» planEndDate å¼€å§‹å€’æ¨
  // 2. äº§å“ç»“æŸæ—¶é—´ = planEndDate
  // 3. å­çº§ç»“æŸæ—¶é—´ = çˆ¶çº§å¼€å§‹æ—¶é—´ - 1å¤©
  // 4. é€’å½’è®¡ç®—æ‰€æœ‰å±‚çº§
  // 5. å¦‚éœ€è°ƒæ•´ï¼Œæ•´ä½“å¹³ç§»æ—¶é—´
}
```

---

## 7. æµ‹è¯•è®¡åˆ’

### 7.1 æµ‹è¯•åœºæ™¯

| ç¼–å· | åœºæ™¯ | é¢„æœŸç»“æœ |
|------|------|----------|
| TC-001 | æ‰€æœ‰ç‰©æ–™åº“å­˜å……è¶³ | æ‰€æœ‰ç‰©æ–™æ˜¾ç¤ºç»¿è‰²ï¼Œ1å¤©è¿›åº¦æ¡ |
| TC-002 | éƒ¨åˆ†ç‰©æ–™åº“å­˜ä¸è¶³ | ä¸è¶³ç‰©æ–™æ˜¾ç¤ºé»„è‰²ï¼Œæ˜¾ç¤ºé‡‡è´­/ç”Ÿäº§å‘¨æœŸ |
| TC-003 | è®¡åˆ’æ—¶é—´å……è¶³ï¼ˆé»˜è®¤æ¨¡å¼ï¼‰ | æ­£å¸¸æ˜¾ç¤ºï¼Œæ— çº¢è‰² |
| TC-004 | è®¡åˆ’æ—¶é—´ä¸è¶³ï¼ˆé»˜è®¤æ¨¡å¼ï¼‰ | è¶…æœŸéƒ¨åˆ†æ˜¾ç¤ºçº¢è‰²ï¼Œæç¤ºå»¶æœŸå¤©æ•° |
| TC-005 | è®¡åˆ’æ—¶é—´å……è¶³ï¼ˆé½å¥—æ¨¡å¼ï¼‰ | æ­£å¸¸æ˜¾ç¤ºï¼ŒçŠ¶æ€æ˜¾ç¤º"æå‰Xå¤©" |
| TC-006 | è®¡åˆ’æ—¶é—´ä¸è¶³ï¼ˆé½å¥—æ¨¡å¼ï¼‰ | è¶…æœŸéƒ¨åˆ†æ˜¾ç¤ºçº¢è‰²ï¼ŒçŠ¶æ€æ˜¾ç¤º"å»¶æœŸXå¤©" |
| TC-007 | BOMå¤šå±‚åµŒå¥— | æ­£ç¡®å±•å¼€/æ”¶ç¼©ï¼Œæ—¶é—´è®¡ç®—æ­£ç¡® |
| TC-008 | ç»„ä»¶æœ‰å­ç»„ä»¶ | ç»„ä»¶ç­‰å¾…å­ç»„ä»¶é½å¥—åæ‰å¼€å§‹ |
| TC-009 | æŸè€—ç‡è®¡ç®— | éœ€æ±‚æ•°é‡æ­£ç¡®è€ƒè™‘æŸè€— |
| TC-010 | æ¨¡å¼åˆ‡æ¢ | åˆ‡æ¢æ¨¡å¼åç”˜ç‰¹å›¾æ­£ç¡®åˆ·æ–° |
| TC-011 | æ›¿ä»£ç‰©æ–™è¿‡æ»¤ | ä¸æ˜¾ç¤º `alternative_part = "æ›¿ä»£"` çš„ç‰©æ–™ |

### 7.2 æµ‹è¯•æ•°æ®

ä½¿ç”¨ä»¥ä¸‹äº§å“ç¼–ç è¿›è¡Œæµ‹è¯•ï¼š
- `T01-000055`: åŒ—æ–—è½¦è½½æ™ºèƒ½ç»ˆç«¯ç³»ç»Ÿ

---

## 8. é£é™©ä¸æ³¨æ„äº‹é¡¹

### 8.1 æ•°æ®å¤„ç†è§„åˆ™

| åœºæ™¯ | å¤„ç†æ–¹å¼ |
|------|---------|
| `loss_rate > 1` | é™¤ä»¥100è½¬ä¸ºå°æ•°ï¼ˆå¦‚ 5 â†’ 0.05ï¼‰ |
| `delivery_duration` ä¸ºç©º | è‡ªåˆ¶ï¼šé»˜è®¤1000/å¤©ï¼›å¤–è´­/å§”å¤–ï¼šé»˜è®¤15å¤© |
| `assembly_time` ä¸ºç©º | é»˜è®¤1000/å¤© |
| `material_type` ä¸ºç©º | é»˜è®¤"å¤–è´­" |
| `available_quantity` ä¸ºç©º | ä½¿ç”¨ `inventory_data`ï¼Œå†ä¸ºç©ºåˆ™ä¸º0 |
| `alternative_part = "æ›¿ä»£"` | è¿‡æ»¤æ‰ï¼Œä¸å‚ä¸è®¡ç®— |

### 8.2 æ€§èƒ½ä¼˜åŒ–

- BOMæ•°æ®ä¸€æ¬¡æ€§åŠ è½½ï¼Œå®¢æˆ·ç«¯è¿‡æ»¤
- ä¸¤ç§æ¨¡å¼çš„è®¡ç®—ç»“æœç¼“å­˜ï¼Œåˆ‡æ¢æ—¶æ— éœ€é‡æ–°è¯·æ±‚
- é™åˆ¶BOMå±•å¼€å±‚çº§ï¼Œé¿å…æ·±åº¦é€’å½’

### 8.3 è¾¹ç•Œæ¡ä»¶

- ç©ºBOMæ•°æ®ï¼šæ˜¾ç¤ºæç¤ºä¿¡æ¯"æš‚æ— äº§å“BOMæ•°æ®"
- æ— ç”Ÿäº§è®¡åˆ’ï¼šæ˜¾ç¤ºæç¤ºä¿¡æ¯
- åº“å­˜ä¸º0ï¼šæ˜¾ç¤ºå®Œæ•´é‡‡è´­/ç”Ÿäº§å‘¨æœŸ
- ç”Ÿäº§æ•ˆç‡ä¸º0ï¼šä½¿ç”¨é»˜è®¤å€¼1000/å¤©

---

## 9. é™„å½•

### 9.1 ç›¸å…³æ–‡ä»¶

| æ–‡ä»¶ | è¯´æ˜ |
|------|------|
| [defaultModeCalculator.ts](../src/utils/defaultModeCalculator.ts) | é»˜è®¤æ¨¡å¼ç®—æ³•å®ç° |
| [materialReadyCalculatorV2.ts](../src/utils/materialReadyCalculatorV2.ts) | é½å¥—æ¨¡å¼ç®—æ³•å®ç° |
| [mpsDataService.ts](../src/services/mpsDataService.ts) | æ•°æ®æœåŠ¡å±‚ |
| [MPSPrototype.tsx](../src/components/planning/MPSPrototype.tsx) | ä¸»ç»„ä»¶ |
| [GanttHeader.tsx](../src/components/planning/GanttHeader.tsx) | é¡¶éƒ¨ä¿¡æ¯æ  |
| [PlanModeSelector.tsx](../src/components/planning/PlanModeSelector.tsx) | æ¨¡å¼é€‰æ‹©å™¨ |
| [GanttBOMTree.tsx](../src/components/planning/GanttBOMTree.tsx) | BOMæ ‘å½¢ç»„ä»¶ |
| [GanttTaskBar.tsx](../src/components/planning/GanttTaskBar.tsx) | è¿›åº¦æ¡ç»„ä»¶ |
| [GanttTooltip.tsx](../src/components/planning/GanttTooltip.tsx) | æ‚¬æµ®æç¤º |
| [LegendPanel.tsx](../src/components/planning/LegendPanel.tsx) | é¢œè‰²å›¾ä¾‹ |

### 9.2 APIæ–‡æ¡£

åç«¯APIæ–‡æ¡£: https://github.com/kweaver-ai/adp/blob/main/docs/ontology/ontology-query/ontology-query.yaml

### 9.3 ç‰ˆæœ¬å†å²

| ç‰ˆæœ¬ | æ—¥æœŸ | å˜æ›´è¯´æ˜ |
|------|------|---------|
| v1.0 | 2026-01-16 | åˆç‰ˆï¼Œé½å¥—æ¨¡å¼è®¾è®¡ |
| v2.0 | 2026-01-17 | å¢åŠ é»˜è®¤æ¨¡å¼çœŸå®æ•°æ®æ”¯æŒï¼Œå®Œå–„ä¸¤ç§æ¨¡å¼å¯¹æ¯” |

---

**æ–‡æ¡£çŠ¶æ€**: å·²å®ç°
**ç»´æŠ¤è€…**: Claude AI
