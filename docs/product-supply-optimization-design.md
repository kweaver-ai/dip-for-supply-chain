# äº§å“ä¾›åº”ä¼˜åŒ–é¡µé¢ - è®¾è®¡æ–‡æ¡£

## 1. æ¶æ„è®¾è®¡

### 1.1 æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ProductSupplyOptimizationPage               â”‚
â”‚                    (ä¸»é¡µé¢ç»„ä»¶)                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          ProductSupplyAnalysisPanel                      â”‚
â”‚              (åˆ†æé¢æ¿å®¹å™¨)                                â”‚
â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚          â”‚          â”‚          â”‚          â”‚
    â–¼          â–¼          â–¼          â–¼          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Product  â”‚ â”‚Product  â”‚ â”‚Product  â”‚ â”‚Product  â”‚ â”‚Product  â”‚
â”‚Selectionâ”‚ â”‚BasicInfoâ”‚ â”‚Metrics  â”‚ â”‚Demand   â”‚ â”‚Suggestedâ”‚
â”‚Section  â”‚ â”‚Section  â”‚ â”‚Cards    â”‚ â”‚Forecast â”‚ â”‚Actions  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 ç»„ä»¶å±‚æ¬¡ç»“æ„

```
ProductSupplyOptimizationPage (ä¸»é¡µé¢)
â”œâ”€â”€ Header (æ ‡é¢˜å’Œæ“ä½œæ )
â”œâ”€â”€ ProductSupplyAnalysisPanel (åˆ†æé¢æ¿)
â”‚   â”œâ”€â”€ AI Suggestions Section (AIå»ºè®®åŒºåŸŸ)
â”‚   â”œâ”€â”€ ProductSelectionSection (äº§å“é€‰æ‹©)
â”‚   â”œâ”€â”€ ProductBasicInfoSection (åŸºæœ¬ä¿¡æ¯)
â”‚   â”œâ”€â”€ ProductSupplyMetricsCards (æŒ‡æ ‡å¡ç‰‡)
â”‚   â”‚   â”œâ”€â”€ ProductOrderCountCard (è®¢å•æ•°é‡å¡ç‰‡)
â”‚   â”‚   â”œâ”€â”€ ProductInventoryCard (åº“å­˜å¡ç‰‡)
â”‚   â”‚   â””â”€â”€ å…¶ä»–æŒ‡æ ‡å¡ç‰‡
â”‚   â”œâ”€â”€ ProductSuggestedActionsSection (å»ºè®®åŠ¨ä½œ)
â”‚   â””â”€â”€ ProductDemandForecastPanelNew (éœ€æ±‚é¢„æµ‹é¢æ¿)
â”‚       â”œâ”€â”€ AlgorithmSelector (ç®—æ³•é€‰æ‹©å™¨)
â”‚       â””â”€â”€ ForecastComparisonChart (é¢„æµ‹å¯¹æ¯”å›¾è¡¨)
â””â”€â”€ Floating Chat Button (æµ®åŠ¨èŠå¤©æŒ‰é’®)
```

### 1.3 æ•°æ®æµè®¾è®¡

```
API Layer (ontologyApi)
    â”‚
    â–¼
Service Layer (productSupplyOptimizationService)
    â”‚
    â”œâ”€â”€ loadProducts() â†’ Product[]
    â”œâ”€â”€ loadBOM() â†’ BOMEvent[]
    â”œâ”€â”€ loadInventory() â†’ InventoryEvent[]
    â”œâ”€â”€ loadSalesOrders() â†’ SalesOrderEvent[]
    â””â”€â”€ getAllProductsSupplyAnalysis() â†’ ProductSupplyAnalysis[]
    â”‚
    â–¼
Component Layer
    â”‚
    â”œâ”€â”€ ProductSupplyOptimizationPage (çŠ¶æ€ç®¡ç†)
    â”œâ”€â”€ ProductSupplyAnalysisPanel (æ•°æ®å±•ç¤º)
    â””â”€â”€ å­ç»„ä»¶ (æ•°æ®æ¶ˆè´¹)
```

## 2. ç»„ä»¶è®¾è®¡

### 2.1 ProductSupplyOptimizationPage

**èŒè´£**: é¡µé¢ä¸»å®¹å™¨ï¼Œç®¡ç†å…¨å±€çŠ¶æ€å’Œæ•°æ®åŠ è½½

**Props**: 
```typescript
{
  toggleCopilot?: () => void;
}
```

**State**:
```typescript
{
  selectedProductId: string | null;
  analyses: ProductSupplyAnalysis[];
  demandForecasts: Map<string, DemandForecast>;
  loading: boolean;
  selectedProduct: Product | null;
  dataSource: 'api' | 'fallback';
  dataSourceError: string | null;
}
```

**å…³é”®æ–¹æ³•**:
- `loadAllData()`: åˆå§‹åŒ–æ—¶åŠ è½½æ‰€æœ‰äº§å“åˆ†ææ•°æ®
- `loadProductDetails()`: åˆ‡æ¢äº§å“æ—¶åŠ è½½è¯¦ç»†ä¿¡æ¯

### 2.2 ProductSupplyAnalysisPanel

**èŒè´£**: åˆ†æé¢æ¿å®¹å™¨ï¼Œç»„ç»‡å„ä¸ªå­ç»„ä»¶

**Props**:
```typescript
{
  analysis: ProductSupplyAnalysis | null;
  loading?: boolean;
  allProducts?: ProductSupplyAnalysis[];
  selectedProductId?: string | null;
  onProductSelect?: (productId: string) => void;
  demandForecasts?: Map<string, DemandForecast>;
  product?: Product | null;
  productLifecycleAssessment?: ProductLifecycleAssessment | null;
}
```

### 2.3 ProductSelectionSection

**èŒè´£**: äº§å“é€‰æ‹©ä¸‹æ‹‰æ¡†

**Props**:
```typescript
{
  allProducts: ProductSupplyAnalysis[];
  selectedProductId: string | null;
  onProductSelect?: (productId: string) => void;
}
```

**UIè®¾è®¡**:
- ä¸‹æ‹‰é€‰æ‹©æ¡†ï¼ˆ`<select>`ï¼‰
- é€‰é¡¹æ ¼å¼ï¼š`äº§å“ç¼–ç -äº§å“åç§°`
- é»˜è®¤å€¼ï¼š"è¯·é€‰æ‹©äº§å“"

### 2.4 ProductSupplyMetricsCards

**èŒè´£**: æ˜¾ç¤ºä¾›åº”æŒ‡æ ‡å¡ç‰‡ç½‘æ ¼

**Props**:
```typescript
{
  analysis: ProductSupplyAnalysis;
}
```

**å¡ç‰‡å¸ƒå±€**:
- ç½‘æ ¼å¸ƒå±€ï¼š`grid-cols-1 md:grid-cols-5`
- 5ä¸ªæŒ‡æ ‡å¡ç‰‡ï¼š
  1. è®¢å•æ•°é‡å¡ç‰‡ï¼ˆProductOrderCountCardï¼‰
  2. ä¾›åº”å•†æ•°é‡
  3. å¹³å‡äº¤è´§å‘¨æœŸ
  4. ä¾›è´§ç¨³å®šæ€§è¯„åˆ†
  5. åº“å­˜å¡ç‰‡ï¼ˆProductInventoryCardï¼‰
  6. ç¼ºè´§é£é™©ç­‰çº§

### 2.5 ProductDemandForecastPanelNew

**èŒè´£**: éœ€æ±‚é¢„æµ‹é¢æ¿ï¼Œæ”¯æŒå¤šç®—æ³•é¢„æµ‹

**Props**:
```typescript
{
  productId: string;
  productName: string;
  loading?: boolean;
}
```

**State**:
```typescript
{
  selectedAlgorithm: ForecastAlgorithm;
  forecastData: ForecastComparisonData[];
  loading: boolean;
  error: string | null;
  hasGenerated: boolean;
  stats: {
    avgActual: number;
    avgForecast: number;
    totalForecast: number;
    confidenceLevel: 'high' | 'medium' | 'low';
  } | null;
}
```

**åŠŸèƒ½**:
- ç®—æ³•é€‰æ‹©å™¨ï¼ˆProphetã€ç®€å•æŒ‡æ•°å¹³æ»‘ã€Holtçº¿æ€§ã€Holt-Wintersï¼‰
- ç”Ÿæˆé¢„æµ‹æŒ‰é’®
- é¢„æµ‹å¯¹æ¯”å›¾è¡¨ï¼ˆè¿‡å»12ä¸ªæœˆ + æœªæ¥12ä¸ªæœˆï¼‰
- ç»Ÿè®¡ä¿¡æ¯å±•ç¤º

### 2.6 ProductOrderCountCard

**èŒè´£**: è®¢å•æ•°é‡å¡ç‰‡ï¼Œæ˜¾ç¤ºè®¢å•ç»Ÿè®¡ä¿¡æ¯

**Props**:
```typescript
{
  productId: string;
}
```

**åŠŸèƒ½**:
- ä»APIæŸ¥è¯¢é”€å”®è®¢å•æ•°æ®
- è®¡ç®—æ€»ç­¾çº¦æ•°é‡ã€å·²äº¤ä»˜æ•°é‡ã€å¾…äº¤ä»˜æ•°é‡ã€å®Œæˆç‡
- ç‚¹å‡»æ‰“å¼€è®¢å•äº¤ä»˜åˆ†ææ¨¡æ€æ¡†

## 3. æœåŠ¡å±‚è®¾è®¡

### 3.1 productSupplyOptimizationService

**èŒè´£**: äº§å“ä¾›åº”ä¼˜åŒ–æ•°æ®æœåŠ¡

**ä¸»è¦å‡½æ•°**:

1. **loadProducts()**: åŠ è½½äº§å“æ•°æ®
   - è°ƒç”¨: `ontologyApi.queryObjectInstances(OBJECT_TYPE_IDS.PRODUCT)`
   - è¿”å›: `Product[]`

2. **loadBOM()**: åŠ è½½BOMæ•°æ®
   - è°ƒç”¨: `ontologyApi.queryObjectInstances(OBJECT_TYPE_IDS.BOM)`
   - è¿”å›: `BOMEvent[]`

3. **loadInventory()**: åŠ è½½åº“å­˜æ•°æ®
   - è°ƒç”¨: `ontologyApi.queryObjectInstances(OBJECT_TYPE_IDS.INVENTORY)`
   - è¿”å›: `InventoryEvent[]`

4. **loadSalesOrders()**: åŠ è½½é”€å”®è®¢å•æ•°æ®
   - è°ƒç”¨: `ontologyApi.queryObjectInstances(OBJECT_TYPE_IDS.SALES_ORDER)`
   - è¿”å›: `SalesOrderEvent[]`

5. **loadAllProductSupplyData()**: å¹¶è¡ŒåŠ è½½æ‰€æœ‰æ•°æ®
   - ä½¿ç”¨ `Promise.all()` å¹¶è¡ŒåŠ è½½
   - å¡«å……äº§å“çš„materialCodeså’ŒstockQuantity

6. **generateProductSupplyAnalysis()**: ç”Ÿæˆäº§å“ä¾›åº”åˆ†æ
   - è¾“å…¥: productId, products, bom, inventory, salesOrders
   - è¾“å‡º: `ProductSupplyAnalysis`
   - è®¡ç®—é€»è¾‘ï¼š
     - ä¾›åº”å•†æ•°é‡ï¼ˆåŸºäºBOMç‰©æ–™æ•°é‡ä¼°ç®—ï¼‰
     - å¹³å‡äº¤è´§å‘¨æœŸï¼ˆåŸºäºé”€å”®è®¢å•æ—¥æœŸå·®ï¼‰
     - ä¾›è´§ç¨³å®šæ€§è¯„åˆ†ï¼ˆåŸºäºäº¤è´§å‘¨æœŸï¼‰
     - ç¼ºè´§é£é™©ç­‰çº§ï¼ˆåŸºäºåº“å­˜è¦†ç›–æœˆæ•°ï¼‰
     - éœ€æ±‚è¶‹åŠ¿ï¼ˆåŸºäºè®¢å•æ•°é‡å˜åŒ–ï¼‰
     - ä¾›åº”é£é™©ï¼ˆåŸºäºç¼ºè´§é£é™©å’Œä¾›åº”å•†æ•°é‡ï¼‰

7. **getAllProductsSupplyAnalysis()**: ç”Ÿæˆæ‰€æœ‰äº§å“çš„ä¾›åº”åˆ†æ
   - è¿‡æ»¤çŠ¶æ€ä¸º"é”€å”®ä¸­"æˆ–"Active"çš„äº§å“
   - å¹¶è¡Œç”Ÿæˆæ‰€æœ‰äº§å“çš„åˆ†æ

### 3.2 ProductOrderCalculator

**èŒè´£**: äº§å“è®¢å•è®¡ç®—å™¨

**ä¸»è¦æ–¹æ³•**:

1. **init()**: åˆå§‹åŒ–ï¼Œä»APIåŠ è½½é”€å”®è®¢å•æ•°æ®
2. **calculateOrderAnalysis(productId)**: è®¡ç®—è®¢å•åˆ†æç»“æœ
   - æ€»ç­¾çº¦æ•°é‡ = sum(signing_quantity)
   - å·²äº¤ä»˜æ•°é‡ = sum(shipping_quantity)
   - å¾…äº¤ä»˜æ•°é‡ = æ€»ç­¾çº¦æ•°é‡ - å·²äº¤ä»˜æ•°é‡
   - å®Œæˆç‡ = (å·²äº¤ä»˜æ•°é‡ / æ€»ç­¾çº¦æ•°é‡) * 100%

## 4. æ•°æ®æ¨¡å‹è®¾è®¡

### 4.1 ProductSupplyAnalysis

```typescript
interface ProductSupplyAnalysis {
  productId: string;
  productName: string;
  currentStock: number;
  safetyStock: number;
  stockDays: number;
  demandTrend: 'increasing' | 'decreasing';
  supplyRisk: 'low' | 'medium' | 'high';
  recommendation: string;
  supplierCount: number;
  averageDeliveryCycle: number;
  supplyStabilityScore: number;
  currentInventoryLevel: number;
  stockoutRiskLevel: 'low' | 'medium' | 'high' | 'critical';
  lastUpdated: string;
  leadTime: number;
  reorderPoint: number;
  economicOrderQuantity: number;
}
```

### 4.2 Product

```typescript
interface Product {
  productId: string;        // äº§å“ç¼–ç 
  productName: string;      // äº§å“åç§°
  materialCodes: string[];   // ç‰©æ–™ç¼–ç åˆ—è¡¨ï¼ˆä»BOMè·å–ï¼‰
  status: string;            // äº§å“çŠ¶æ€
  stockQuantity: number;     // åº“å­˜æ•°é‡ï¼ˆä»åº“å­˜è·å–ï¼‰
  stockUnit: string;         // åº“å­˜å•ä½
}
```

### 4.3 OrderAnalysisResult

```typescript
interface OrderAnalysisResult {
  productId: string;
  totalOrders: number;      // è®¢å•æ•°é‡
  totalQuantity: number;     // æ€»ç­¾çº¦æ•°é‡
  deliveredQuantity: number; // å·²äº¤ä»˜æ•°é‡
  pendingQuantity: number;  // å¾…äº¤ä»˜æ•°é‡
  completionRate: number;   // å®Œæˆç‡ï¼ˆ0-100ï¼‰
}
```

## 5. UI/UXè®¾è®¡

### 5.1 é¢œè‰²æ–¹æ¡ˆ

- **ä¸»è‰²è°ƒ**: Indigo/Purpleæ¸å˜ï¼ˆ`from-indigo-600 to-purple-600`ï¼‰
- **æˆåŠŸ/ä½é£é™©**: Emeraldç»¿è‰²ç³»
- **è­¦å‘Š/ä¸­é£é™©**: Amberé»„è‰²ç³»
- **å±é™©/é«˜é£é™©**: Redçº¢è‰²ç³»
- **ä¿¡æ¯**: Blueè“è‰²ç³»
- **èƒŒæ™¯**: Slateç°è‰²ç³»

### 5.2 å¡ç‰‡è®¾è®¡

- **èƒŒæ™¯**: ç™½è‰²ï¼ˆ`bg-white`ï¼‰
- **è¾¹æ¡†**: æµ…ç°è‰²ï¼ˆ`border border-slate-200`ï¼‰
- **é˜´å½±**: è½»å¾®é˜´å½±ï¼Œhoveræ—¶å¢å¼ºï¼ˆ`shadow-sm hover:shadow-md`ï¼‰
- **åœ†è§’**: å¤§åœ†è§’ï¼ˆ`rounded-xl`ï¼‰
- **å†…è¾¹è·**: ä¸­ç­‰ï¼ˆ`p-6`ï¼‰

### 5.3 æŒ‡æ ‡å¡ç‰‡è®¾è®¡

- **æ¸å˜èƒŒæ™¯**: ä»æµ…è‰²åˆ°æ›´æµ…è‰²ï¼ˆå¦‚`from-blue-50 to-blue-100/50`ï¼‰
- **å›¾æ ‡**: åœ†å½¢èƒŒæ™¯ï¼ŒåŠé€æ˜ï¼ˆå¦‚`bg-blue-500/10`ï¼‰
- **æ•°å€¼**: å¤§å·ç²—ä½“ï¼ˆ`text-2xl font-bold`ï¼‰
- **å•ä½**: å°å·ç°è‰²ï¼ˆ`text-xs text-slate-500`ï¼‰

### 5.4 å“åº”å¼æ–­ç‚¹

- **ç§»åŠ¨ç«¯**: `< 768px` (mdæ–­ç‚¹ä»¥ä¸‹)
- **æ¡Œé¢ç«¯**: `>= 768px` (mdæ–­ç‚¹åŠä»¥ä¸Š)

### 5.5 åŠ¨ç”»æ•ˆæœ

- **è¿‡æ¸¡**: `transition-shadow`, `transition-colors`, `transition-all`
- **åŠ è½½**: éª¨æ¶å±åŠ¨ç”»ï¼ˆ`animate-pulse`ï¼‰
- **æ·¡å…¥**: `animate-in fade-in duration-200`

## 6. é”™è¯¯å¤„ç†è®¾è®¡

### 6.1 é”™è¯¯è¾¹ç•Œ

- ä½¿ç”¨ `ErrorBoundary` ç»„ä»¶åŒ…è£¹å…³é”®å­ç»„ä»¶
- é”™è¯¯æ—¶æ˜¾ç¤ºå‹å¥½çš„é”™è¯¯ä¿¡æ¯ï¼Œä¸å½±å“å…¶ä»–ç»„ä»¶

### 6.2 APIé”™è¯¯å¤„ç†

- æ•°æ®åŠ è½½å¤±è´¥æ—¶æ˜¾ç¤ºè­¦å‘Šæç¤ºï¼ˆé»„è‰²èƒŒæ™¯ï¼‰
- æ˜¾ç¤ºå…·ä½“é”™è¯¯ä¿¡æ¯
- ä¸è‡ªåŠ¨fallbackåˆ°æ¨¡æ‹Ÿæ•°æ®

### 6.3 æ•°æ®éªŒè¯

- æ£€æŸ¥å¿…éœ€å­—æ®µæ˜¯å¦å­˜åœ¨
- è¿‡æ»¤æ— æ•ˆæ•°æ®ï¼ˆå¦‚productIdä¸ºç©ºï¼‰
- æ•°å€¼è®¡ç®—æ—¶å¤„ç†null/undefined

## 7. æ€§èƒ½ä¼˜åŒ–è®¾è®¡

### 7.1 æ•°æ®åŠ è½½ä¼˜åŒ–

- ä½¿ç”¨ `Promise.all()` å¹¶è¡ŒåŠ è½½å¤šä¸ªæ•°æ®æº
- æ•°æ®åŠ è½½å®Œæˆåæ‰æ¸²æŸ“ç»„ä»¶
- ä½¿ç”¨loadingçŠ¶æ€æ˜¾ç¤ºåŠ è½½è¿›åº¦

### 7.2 ç»„ä»¶ä¼˜åŒ–

- ä½¿ç”¨React.memoä¼˜åŒ–å­ç»„ä»¶æ¸²æŸ“
- é¿å…ä¸å¿…è¦çš„é‡æ–°æ¸²æŸ“
- ä½¿ç”¨useMemoç¼“å­˜è®¡ç®—ç»“æœ

### 7.3 å›¾è¡¨ä¼˜åŒ–

- é¢„æµ‹å›¾è¡¨ä½¿ç”¨è™šæ‹Ÿæ»šåŠ¨ï¼ˆå¦‚æœæ•°æ®é‡å¤§ï¼‰
- å›¾è¡¨æ•°æ®æ›´æ–°æ—¶ä½¿ç”¨è¿‡æ¸¡åŠ¨ç”»

---

## 8. å…±ç”¨é¢„æµ‹ç®—æ³•æœåŠ¡æ¶æ„è®¾è®¡ (2026-01-17 æ–°å¢)

### 8.1 æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        å‰ç«¯åº”ç”¨å±‚                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚    äº§å“ä¾›åº”ä¼˜åŒ–æ¨¡å—           â”‚         éœ€æ±‚è®¡åˆ’é¢æ¿                   â”‚
â”‚    (ProductSupply           â”‚    (DemandPlanningPanel)              â”‚
â”‚     OptimizationPage)       â”‚                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚                                â”‚
               â–¼                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     å‰ç«¯æœåŠ¡å±‚                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ forecastOperatorService.ts                                     â”‚  â”‚
â”‚  â”‚   - forecast(algorithm, input)                                 â”‚  â”‚
â”‚  â”‚   - batchForecast(algorithm, inputs)                           â”‚  â”‚
â”‚  â”‚   - forecastLocal(algorithm, input)  // æœ¬åœ°å›é€€               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ forecastAlgorithmService.ts (æœ¬åœ°å®ç° - ä¿ç•™ç”¨äºå›é€€)          â”‚  â”‚
â”‚  â”‚   - simpleExponentialSmoothing()                               â”‚  â”‚
â”‚  â”‚   - holtLinearSmoothing()                                      â”‚  â”‚
â”‚  â”‚   - holtWintersSmoothing()                                     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚ HTTP/REST
                                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    APIç½‘å…³å±‚ (Nginx/Kong)                            â”‚
â”‚  /proxy-forecast/v1/  ->  forecast-operator-service:8000            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
                                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                Pythoné¢„æµ‹ç®—å­æœåŠ¡ (FastAPI)                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ API Layer (main.py)                                            â”‚  â”‚
â”‚  â”‚   /api/v1/forecast/                                            â”‚  â”‚
â”‚  â”‚     â”œâ”€â”€ /prophet                                               â”‚  â”‚
â”‚  â”‚     â”œâ”€â”€ /simple-exp                                            â”‚  â”‚
â”‚  â”‚     â”œâ”€â”€ /holt-linear                                           â”‚  â”‚
â”‚  â”‚     â”œâ”€â”€ /holt-winters                                          â”‚  â”‚
â”‚  â”‚     â”œâ”€â”€ /arima                                                 â”‚  â”‚
â”‚  â”‚     â”œâ”€â”€ /ensemble                                              â”‚  â”‚
â”‚  â”‚     â””â”€â”€ /batch                                                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Operator Layer (forecast_operators/)                           â”‚  â”‚
â”‚  â”‚   â”œâ”€â”€ base.py             # ç®—å­åŸºç±»                           â”‚  â”‚
â”‚  â”‚   â”œâ”€â”€ prophet_op.py       # Prophetç®—å­                        â”‚  â”‚
â”‚  â”‚   â”œâ”€â”€ exp_smoothing.py    # æŒ‡æ•°å¹³æ»‘ç®—å­ (3ç§)                 â”‚  â”‚
â”‚  â”‚   â”œâ”€â”€ arima_op.py         # ARIMAç®—å­                          â”‚  â”‚
â”‚  â”‚   â”œâ”€â”€ ensemble_op.py      # é›†æˆé¢„æµ‹ç®—å­                       â”‚  â”‚
â”‚  â”‚   â””â”€â”€ utils.py            # é€šç”¨å·¥å…·                           â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 8.2 ç®—æ³•é€‰æ‹©ç­–ç•¥

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ç®—æ³•é€‰æ‹©å†³ç­–æ ‘                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ å†å²æ•°æ®é‡ >= 24 â”‚
                    â”‚     ä¸ªæœˆ?        â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ Yes                          â”‚ No
              â–¼                              â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ æ•°æ®æœ‰å­£èŠ‚æ€§?    â”‚            â”‚ æ•°æ® >= 12ä¸ªæœˆ? â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚                              â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚Yes              â”‚No          â”‚Yes              â”‚No
    â–¼                 â–¼            â–¼                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Prophetæˆ–    â”‚  â”‚Holtçº¿æ€§    â”‚ â”‚ç®€å•æŒ‡æ•°    â”‚  â”‚ç§»åŠ¨å¹³å‡    â”‚
â”‚Holt-Wintersâ”‚  â”‚æŒ‡æ•°å¹³æ»‘    â”‚ â”‚å¹³æ»‘        â”‚  â”‚(å¤‡é€‰)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ¨èåœºæ™¯:
- Prophet: æ•°æ®é‡å……è¶³ï¼Œæœ‰å¤æ‚å­£èŠ‚æ€§å’Œè¶‹åŠ¿
- Holt-Winters: æœ‰æ˜æ˜¾å¹´å­£èŠ‚æ€§(12ä¸ªæœˆå‘¨æœŸ)
- Holtçº¿æ€§: æœ‰è¶‹åŠ¿ä½†æ— å­£èŠ‚æ€§
- ç®€å•æŒ‡æ•°: æ•°æ®ç¨³å®šï¼Œæ— æ˜æ˜¾è¶‹åŠ¿
- ARIMA: éœ€è¦è‡ªåŠ¨å‚æ•°ä¼˜åŒ–çš„å¤æ‚æ—¶åº
- é›†æˆé¢„æµ‹: éœ€è¦ç»¼åˆå¤šç§ç®—æ³•ç»“æœ
```

### 8.3 æ•°æ®æµè®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        æ•°æ®æµç¤ºæ„å›¾                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1. å†å²æ•°æ®è·å–æµç¨‹:
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ å‰ç«¯ç»„ä»¶    â”‚ --> â”‚ontologyApi â”‚ --> â”‚çŸ¥è¯†ç½‘ç»œAPI  â”‚
   â”‚            â”‚     â”‚            â”‚     â”‚            â”‚
   â”‚ å‘èµ·æ•°æ®   â”‚     â”‚ æŸ¥è¯¢äº§å“   â”‚     â”‚ è¿”å›é”€å”®   â”‚
   â”‚ åŠ è½½è¯·æ±‚   â”‚     â”‚ é”€å”®å†å²   â”‚     â”‚ å†å²æ•°æ®   â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

2. é¢„æµ‹ç”Ÿæˆæµç¨‹:
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ å‰ç«¯ç»„ä»¶    â”‚ --> â”‚forecast    â”‚ --> â”‚Pythonç®—å­  â”‚
   â”‚            â”‚     â”‚Operator    â”‚     â”‚æœåŠ¡        â”‚
   â”‚ é€‰æ‹©ç®—æ³•   â”‚     â”‚Service     â”‚     â”‚            â”‚
   â”‚ å‘èµ·é¢„æµ‹   â”‚     â”‚ å‘é€HTTP   â”‚     â”‚ æ‰§è¡Œé¢„æµ‹   â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                                      â”‚
         â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
         â”‚              â”‚ é¢„æµ‹ç»“æœ    â”‚          â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ å±•ç¤ºå›¾è¡¨   â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

3. æœ¬åœ°å›é€€æµç¨‹ (APIä¸å¯ç”¨æ—¶):
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ å‰ç«¯ç»„ä»¶    â”‚ --> â”‚forecast    â”‚ -X- â”‚Pythonç®—å­  â”‚
   â”‚            â”‚     â”‚Operator    â”‚     â”‚(ä¸å¯ç”¨)    â”‚
   â”‚ é€‰æ‹©ç®—æ³•   â”‚     â”‚Service     â”‚     â”‚            â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼ å›é€€
                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                      â”‚forecast    â”‚
                      â”‚Algorithm   â”‚
                      â”‚Service     â”‚
                      â”‚(æœ¬åœ°TSå®ç°)â”‚
                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 8.4 æ¥å£è®¾è®¡è§„èŒƒ

#### 8.4.1 ç»Ÿä¸€è¯·æ±‚æ ¼å¼

```typescript
interface ForecastRequest {
  product_id: string;                    // äº§å“ID
  historical_data: HistoricalDataPoint[]; // å†å²æ•°æ®
  forecast_periods: number;              // é¢„æµ‹æœŸæ•° (é»˜è®¤12)
  parameters?: AlgorithmParameters;      // ç®—æ³•å‚æ•° (å¯é€‰)
}

interface HistoricalDataPoint {
  month: string;   // æ ¼å¼: "YYYY-MM"
  quantity: number; // é”€å”®/éœ€æ±‚æ•°é‡
}

interface AlgorithmParameters {
  // é€šç”¨å‚æ•°
  alpha?: number;        // æ°´å¹³å¹³æ»‘ç³»æ•° (0-1)
  beta?: number;         // è¶‹åŠ¿å¹³æ»‘ç³»æ•° (0-1)
  gamma?: number;        // å­£èŠ‚å¹³æ»‘ç³»æ•° (0-1)
  season_length?: number; // å­£èŠ‚å‘¨æœŸ (é»˜è®¤12)

  // Prophetç‰¹æœ‰å‚æ•°
  seasonality_mode?: 'additive' | 'multiplicative';
  yearly_seasonality?: boolean;

  // ARIMAç‰¹æœ‰å‚æ•°
  p?: number;  // è‡ªå›å½’é˜¶æ•°
  d?: number;  // å·®åˆ†é˜¶æ•°
  q?: number;  // ç§»åŠ¨å¹³å‡é˜¶æ•°
  auto?: boolean; // è‡ªåŠ¨é€‰å‚

  // é›†æˆé¢„æµ‹å‚æ•°
  algorithms?: string[];  // ä½¿ç”¨çš„ç®—æ³•åˆ—è¡¨
  weights?: number[];     // å„ç®—æ³•æƒé‡
  method?: 'weighted_average' | 'median';
}
```

#### 8.4.2 ç»Ÿä¸€å“åº”æ ¼å¼

```typescript
interface ForecastResponse {
  product_id: string;           // äº§å“ID
  algorithm: string;            // ä½¿ç”¨çš„ç®—æ³•
  forecast_values: number[];    // é¢„æµ‹å€¼æ•°ç»„
  confidence_intervals?: ConfidenceInterval[]; // ç½®ä¿¡åŒºé—´ (å¯é€‰)
  metrics?: ForecastMetrics;    // é¢„æµ‹æŒ‡æ ‡ (å¯é€‰)
  generated_at: string;         // ç”Ÿæˆæ—¶é—´ (ISOæ ¼å¼)
}

interface ConfidenceInterval {
  lower: number;  // ä¸‹ç•Œ
  upper: number;  // ä¸Šç•Œ
}

interface ForecastMetrics {
  mape?: number;   // å¹³å‡ç»å¯¹ç™¾åˆ†æ¯”è¯¯å·®
  rmse?: number;   // å‡æ–¹æ ¹è¯¯å·®
  mae?: number;    // å¹³å‡ç»å¯¹è¯¯å·®
}
```

### 8.5 é”™è¯¯å¤„ç†è®¾è®¡

```typescript
// é”™è¯¯ç å®šä¹‰
enum ForecastErrorCode {
  INVALID_INPUT = 'FORECAST_001',      // è¾“å…¥æ•°æ®æ— æ•ˆ
  INSUFFICIENT_DATA = 'FORECAST_002',  // å†å²æ•°æ®ä¸è¶³
  ALGORITHM_ERROR = 'FORECAST_003',    // ç®—æ³•æ‰§è¡Œé”™è¯¯
  SERVICE_UNAVAILABLE = 'FORECAST_004', // æœåŠ¡ä¸å¯ç”¨
  TIMEOUT = 'FORECAST_005',            // è¯·æ±‚è¶…æ—¶
}

interface ForecastError {
  code: ForecastErrorCode;
  message: string;
  details?: any;
}

// é”™è¯¯å¤„ç†ç­–ç•¥
const handleForecastError = async (
  error: ForecastError,
  input: ForecastRequest,
  algorithm: ForecastAlgorithm
): Promise<ForecastResponse | null> => {
  switch (error.code) {
    case ForecastErrorCode.SERVICE_UNAVAILABLE:
    case ForecastErrorCode.TIMEOUT:
      // å°è¯•æœ¬åœ°å›é€€
      if (['simple_exponential', 'holt_linear', 'holt_winters'].includes(algorithm)) {
        return forecastOperatorService.forecastLocal(algorithm, input);
      }
      break;
    case ForecastErrorCode.INSUFFICIENT_DATA:
      // é™çº§åˆ°ç®€å•ç®—æ³•
      return forecastOperatorService.forecastLocal('simple_exponential', input);
    default:
      // è®°å½•é”™è¯¯æ—¥å¿—
      console.error('[Forecast Error]', error);
  }
  return null;
};
```

### 8.6 ç¼“å­˜è®¾è®¡

```typescript
// ç¼“å­˜ç­–ç•¥
interface ForecastCache {
  key: string;          // ç¼“å­˜é”®: `${productId}_${algorithm}_${dataHash}`
  value: ForecastResponse;
  expiry: number;       // è¿‡æœŸæ—¶é—´æˆ³
  createdAt: number;    // åˆ›å»ºæ—¶é—´æˆ³
}

// ç¼“å­˜é…ç½®
const CACHE_CONFIG = {
  maxAge: 3600000,      // 1å°æ—¶
  maxSize: 100,         // æœ€å¤šç¼“å­˜100ä¸ªé¢„æµ‹ç»“æœ
  cleanupInterval: 300000, // 5åˆ†é’Ÿæ¸…ç†ä¸€æ¬¡
};

// ç¼“å­˜é”®ç”Ÿæˆ
const generateCacheKey = (
  productId: string,
  algorithm: string,
  historicalData: HistoricalDataPoint[]
): string => {
  const dataHash = hashHistoricalData(historicalData);
  return `forecast_${productId}_${algorithm}_${dataHash}`;
};
```

### 8.7 ç›‘æ§æŒ‡æ ‡è®¾è®¡

```typescript
// ç›‘æ§æŒ‡æ ‡
interface ForecastMetrics {
  // è¯·æ±‚æŒ‡æ ‡
  requestCount: number;      // è¯·æ±‚æ€»æ•°
  successCount: number;      // æˆåŠŸæ•°
  errorCount: number;        // é”™è¯¯æ•°
  latencyP50: number;        // P50å»¶è¿Ÿ
  latencyP95: number;        // P95å»¶è¿Ÿ
  latencyP99: number;        // P99å»¶è¿Ÿ

  // ä¸šåŠ¡æŒ‡æ ‡
  algorithmUsage: Record<string, number>;  // å„ç®—æ³•ä½¿ç”¨æ¬¡æ•°
  fallbackCount: number;     // æœ¬åœ°å›é€€æ¬¡æ•°
  cacheHitRate: number;      // ç¼“å­˜å‘½ä¸­ç‡

  // é¢„æµ‹è´¨é‡æŒ‡æ ‡
  averageMape: number;       // å¹³å‡MAPE
  predictionAccuracy: number; // é¢„æµ‹å‡†ç¡®ç‡
}

// PrometheusæŒ‡æ ‡ç¤ºä¾‹
const forecastRequestTotal = new Counter({
  name: 'forecast_request_total',
  help: 'Total number of forecast requests',
  labelNames: ['algorithm', 'status'],
});

const forecastLatency = new Histogram({
  name: 'forecast_latency_seconds',
  help: 'Forecast request latency in seconds',
  labelNames: ['algorithm'],
  buckets: [0.1, 0.25, 0.5, 1, 2.5, 5, 10],
});
```

---

## 9. é¢„æµ‹ç®—æ³•å‚æ•°é…ç½®ä¼˜åŒ–è®¾è®¡ (2026-01-18 æ–°å¢)

### 9.1 è®¾è®¡ç›®æ ‡

ä¼˜åŒ–éœ€æ±‚é¢„æµ‹æµç¨‹ï¼Œè®©ç”¨æˆ·å¯ä»¥ï¼š
1. å…ˆé€‰æ‹©é¢„æµ‹ç®—æ³•
2. æ ¹æ®æ‰€é€‰ç®—æ³•ï¼Œæ˜¾ç¤ºå¯¹åº”çš„å¯é…ç½®å‚æ•°ï¼ˆå¦‚å­£èŠ‚æ€§å› å­ã€å¹³æ»‘ç³»æ•°ç­‰ï¼‰
3. ç”¨æˆ·è°ƒæ•´å‚æ•°åï¼Œç‚¹å‡»"ç”Ÿæˆéœ€æ±‚é¢„æµ‹"æŒ‰é’®æ‰§è¡Œé¢„æµ‹

### 9.2 å„ç®—æ³•å‚æ•°åˆ†æ

| ç®—æ³• | å‚æ•° | è¯´æ˜ | é»˜è®¤å€¼ | å–å€¼èŒƒå›´ | ç”¨æˆ·å¯è°ƒèŠ‚ |
|------|------|------|--------|----------|------------|
| **ç®€å•æŒ‡æ•°å¹³æ»‘** | Î± (alpha) | æ°´å¹³å¹³æ»‘ç³»æ•°ï¼Œå€¼è¶Šå¤§å¯¹è¿‘æœŸæ•°æ®è¶Šæ•æ„Ÿ | 0.2 | 0.01 - 1.0 | âœ… |
| **Holtçº¿æ€§æŒ‡æ•°å¹³æ»‘** | Î± (alpha) | æ°´å¹³å¹³æ»‘ç³»æ•° | 0.3 | 0.01 - 1.0 | âœ… |
| | Î² (beta) | è¶‹åŠ¿å¹³æ»‘ç³»æ•°ï¼Œå€¼è¶Šå¤§è¶‹åŠ¿å˜åŒ–è¶Šæ•æ„Ÿ | 0.1 | 0.01 - 1.0 | âœ… |
| **Holt-Wintersä¸‰é‡æŒ‡æ•°å¹³æ»‘** | Î± (alpha) | æ°´å¹³å¹³æ»‘ç³»æ•° | 0.3 | 0.01 - 1.0 | âœ… |
| | Î² (beta) | è¶‹åŠ¿å¹³æ»‘ç³»æ•° | 0.1 | 0.01 - 1.0 | âœ… |
| | Î³ (gamma) | å­£èŠ‚å¹³æ»‘ç³»æ•°ï¼Œå€¼è¶Šå¤§å­£èŠ‚æ€§å½±å“è¶Šæ•æ„Ÿ | 0.2 | 0.01 - 1.0 | âœ… |
| | å­£èŠ‚å‘¨æœŸ | ä¸€ä¸ªå®Œæ•´å­£èŠ‚çš„æœˆæ•° | 12 | 3, 4, 6, 12 | âœ… |
| **Propheté¢„æµ‹** | å­£èŠ‚æ€§æ¨¡å¼ | åŠ æ³•æˆ–ä¹˜æ³•å­£èŠ‚æ€§ | multiplicative | additive, multiplicative | âœ… |
| | å¹´åº¦å­£èŠ‚æ€§ | æ˜¯å¦å¯ç”¨å¹´åº¦å­£èŠ‚æ€§ | true | true, false | âœ… |
| | å˜åŒ–ç‚¹çµæ•åº¦ | è¶‹åŠ¿å˜åŒ–ç‚¹æ£€æµ‹çš„çµæ•åº¦ | 0.05 | 0.001 - 0.5 | âœ… |

### 9.3 UIè®¾è®¡æ–¹æ¡ˆ

#### 9.3.1 äº¤äº’æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    éœ€æ±‚é¢„æµ‹å¯¹æ¯”é¢æ¿                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ç®—æ³•é€‰æ‹©              â”‚  â”‚ ç®—æ³•å‚æ•°é…ç½®                      â”‚ â”‚
â”‚  â”‚ [ç®€å•æŒ‡æ•°å¹³æ»‘     â–¼] â”‚  â”‚ (æ ¹æ®é€‰æ‹©çš„ç®—æ³•åŠ¨æ€æ˜¾ç¤º)           â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                  â”‚
â”‚  å½“é€‰æ‹©"ç®€å•æŒ‡æ•°å¹³æ»‘"æ—¶:                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ Î± (å¹³æ»‘ç³»æ•°)                                                  â”‚â”‚
â”‚  â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â—â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  0.2                        â”‚â”‚
â”‚  â”‚ 0.01                           1.0                           â”‚â”‚
â”‚  â”‚                                                               â”‚â”‚
â”‚  â”‚ ğŸ’¡ å€¼è¶Šå¤§å¯¹è¿‘æœŸæ•°æ®è¶Šæ•æ„Ÿï¼Œé€‚åˆæ³¢åŠ¨è¾ƒå¤§çš„æ•°æ®                    â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                  â”‚
â”‚  å½“é€‰æ‹©"Holt-Wintersä¸‰é‡æŒ‡æ•°å¹³æ»‘"æ—¶:                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ Î± (æ°´å¹³å¹³æ»‘)        Î² (è¶‹åŠ¿å¹³æ»‘)        Î³ (å­£èŠ‚å¹³æ»‘)          â”‚â”‚
â”‚  â”‚ â”œâ”€â”€â”€â”€â—â”€â”€â”€â”€â”¤ 0.3    â”œâ”€â”€â”€â—â”€â”€â”€â”€â”€â”¤ 0.1     â”œâ”€â”€â”€â”€â—â”€â”€â”€â”€â”¤ 0.2      â”‚â”‚
â”‚  â”‚                                                               â”‚â”‚
â”‚  â”‚ å­£èŠ‚å‘¨æœŸ: [12ä¸ªæœˆ (å¹´åº¦) â–¼]                                   â”‚â”‚
â”‚  â”‚   é€‰é¡¹: 3ä¸ªæœˆ(å­£åº¦), 4ä¸ªæœˆ, 6ä¸ªæœˆ(åŠå¹´), 12ä¸ªæœˆ(å¹´åº¦)          â”‚â”‚
â”‚  â”‚                                                               â”‚â”‚
â”‚  â”‚ ğŸ’¡ Holt-Wintersé€‚åˆæœ‰æ˜æ˜¾å­£èŠ‚æ€§æ¨¡å¼çš„äº§å“éœ€æ±‚é¢„æµ‹               â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                  â”‚
â”‚  å½“é€‰æ‹©"Propheté¢„æµ‹"æ—¶:                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ å­£èŠ‚æ€§æ¨¡å¼: â—‹ åŠ æ³• (Additive) â— ä¹˜æ³• (Multiplicative)        â”‚â”‚
â”‚  â”‚                                                               â”‚â”‚
â”‚  â”‚ â˜‘ å¯ç”¨å¹´åº¦å­£èŠ‚æ€§                                              â”‚â”‚
â”‚  â”‚                                                               â”‚â”‚
â”‚  â”‚ å˜åŒ–ç‚¹çµæ•åº¦                                                   â”‚â”‚
â”‚  â”‚ â”œâ”€â”€â”€â”€â”€â—â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  0.05                          â”‚â”‚
â”‚  â”‚ 0.001                       0.5                              â”‚â”‚
â”‚  â”‚                                                               â”‚â”‚
â”‚  â”‚ ğŸ’¡ Propheté€‚åˆé•¿æœŸè¶‹åŠ¿å’Œå¤æ‚å­£èŠ‚æ€§æ¨¡å¼çš„éœ€æ±‚é¢„æµ‹                 â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                  â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚                    â”‚   ğŸ”„ ç”Ÿæˆéœ€æ±‚é¢„æµ‹        â”‚                   â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 9.3.2 ç»„ä»¶ç»“æ„

```typescript
// æ–°å¢ç»„ä»¶: AlgorithmParameterPanel
interface AlgorithmParameterPanelProps {
  algorithm: PanelForecastAlgorithm;
  parameters: AlgorithmParameters;
  onParametersChange: (params: AlgorithmParameters) => void;
}

// å‚æ•°ç±»å‹å®šä¹‰
interface AlgorithmParameters {
  // ç®€å•æŒ‡æ•°å¹³æ»‘
  alpha?: number;

  // Holtçº¿æ€§ (ç»§æ‰¿alpha)
  beta?: number;

  // Holt-Winters (ç»§æ‰¿alpha, beta)
  gamma?: number;
  seasonLength?: number;

  // Prophet
  seasonalityMode?: 'additive' | 'multiplicative';
  yearlySeasonality?: boolean;
  changepointPriorScale?: number;
}

// é»˜è®¤å‚æ•°
const DEFAULT_PARAMETERS: Record<PanelForecastAlgorithm, AlgorithmParameters> = {
  simple_exponential: {
    alpha: 0.2,
  },
  holt_linear: {
    alpha: 0.3,
    beta: 0.1,
  },
  holt_winters: {
    alpha: 0.3,
    beta: 0.1,
    gamma: 0.2,
    seasonLength: 12,
  },
  prophet: {
    seasonalityMode: 'multiplicative',
    yearlySeasonality: true,
    changepointPriorScale: 0.05,
  },
};
```

#### 9.3.3 å‚æ•°æ§ä»¶è®¾è®¡

| å‚æ•°ç±»å‹ | æ§ä»¶ç±»å‹ | è¯´æ˜ |
|----------|----------|------|
| å¹³æ»‘ç³»æ•° (Î±, Î², Î³) | Slideræ»‘å— | èŒƒå›´0.01-1.0ï¼Œæ­¥é•¿0.01ï¼Œæ˜¾ç¤ºå½“å‰å€¼ |
| å­£èŠ‚å‘¨æœŸ | Selectä¸‹æ‹‰ | é¢„è®¾é€‰é¡¹: 3/4/6/12ä¸ªæœˆ |
| å­£èŠ‚æ€§æ¨¡å¼ | Radioå•é€‰ | åŠ æ³•/ä¹˜æ³•ä¸¤ä¸ªé€‰é¡¹ |
| å¸ƒå°”å¼€å…³ | Checkbox | å¦‚"å¯ç”¨å¹´åº¦å­£èŠ‚æ€§" |

### 9.4 æ•°æ®æµè®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ProductDemandForecastPanelNew                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  State:                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ selectedAlgorithm: PanelForecastAlgorithm                    â”‚â”‚
â”‚  â”‚ algorithmParameters: AlgorithmParameters                      â”‚â”‚
â”‚  â”‚ forecastData: ForecastComparisonData[]                       â”‚â”‚
â”‚  â”‚ stats: ForecastStats | null                                  â”‚â”‚
â”‚  â”‚ ...                                                          â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                  â”‚
â”‚  ç®—æ³•é€‰æ‹©å˜æ›´:                                                    â”‚
â”‚  setSelectedAlgorithm(newAlgo) â†’                                 â”‚
â”‚    setAlgorithmParameters(DEFAULT_PARAMETERS[newAlgo])           â”‚
â”‚                                                                  â”‚
â”‚  å‚æ•°å˜æ›´:                                                        â”‚
â”‚  setAlgorithmParameters(newParams) â†’                             â”‚
â”‚    (ä¸è‡ªåŠ¨è§¦å‘é¢„æµ‹ï¼Œç­‰å¾…ç”¨æˆ·ç‚¹å‡»æŒ‰é’®)                               â”‚
â”‚                                                                  â”‚
â”‚  ç‚¹å‡»"ç”Ÿæˆéœ€æ±‚é¢„æµ‹":                                               â”‚
â”‚  generateForecast(selectedAlgorithm, algorithmParameters)        â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 9.5 ç®—æ³•æœåŠ¡æ¥å£æ›´æ–°

```typescript
// æ›´æ–°ç®—æ³•å‡½æ•°ç­¾åï¼Œæ¥å—å¯é€‰å‚æ•°

export function simpleExponentialSmoothing(
  history: ProductSalesHistory[],
  periods: number = 12,
  params?: { alpha?: number }
): number[];

export function holtLinearSmoothing(
  history: ProductSalesHistory[],
  periods: number = 12,
  params?: { alpha?: number; beta?: number }
): number[];

export function holtWintersSmoothing(
  history: ProductSalesHistory[],
  periods: number = 12,
  params?: {
    alpha?: number;
    beta?: number;
    gamma?: number;
    seasonLength?: number;
  }
): number[];

// Prophet éœ€è¦é€šè¿‡ API è°ƒç”¨ï¼Œå‚æ•°åœ¨è¯·æ±‚ä½“ä¸­ä¼ é€’
```

### 9.6 å®ç°æ­¥éª¤

1. **æ›´æ–°ç®—æ³•æœåŠ¡** (`forecastAlgorithmService.ts`)
   - ä¿®æ”¹å„ç®—æ³•å‡½æ•°ï¼Œæ¥å—å¯é€‰çš„å‚æ•°å¯¹è±¡
   - ä½¿ç”¨ä¼ å…¥å‚æ•°è¦†ç›–é»˜è®¤å€¼

2. **åˆ›å»ºå‚æ•°é…ç½®ç»„ä»¶** (`AlgorithmParameterPanel.tsx`)
   - æ ¹æ®é€‰ä¸­ç®—æ³•åŠ¨æ€æ¸²æŸ“ä¸åŒçš„å‚æ•°æ§ä»¶
   - ä½¿ç”¨ Slider æ§ä»¶å±•ç¤ºå¹³æ»‘ç³»æ•°
   - ä½¿ç”¨ Select æ§ä»¶å±•ç¤ºå­£èŠ‚å‘¨æœŸé€‰é¡¹
   - æ·»åŠ å‚æ•°è¯´æ˜æç¤º

3. **æ›´æ–°é¢„æµ‹é¢æ¿** (`ProductDemandForecastPanelNew.tsx`)
   - æ·»åŠ  algorithmParameters çŠ¶æ€
   - ç®—æ³•åˆ‡æ¢æ—¶é‡ç½®å‚æ•°ä¸ºé»˜è®¤å€¼
   - ç‚¹å‡»æŒ‰é’®æ—¶ä¼ é€’å‚æ•°ç»™ generateForecast

4. **æ›´æ–°é¢„æµ‹ç”Ÿæˆé€»è¾‘**
   - å›æµ‹é˜¶æ®µä½¿ç”¨ç”¨æˆ·é…ç½®çš„å‚æ•°
   - æœªæ¥é¢„æµ‹é˜¶æ®µä½¿ç”¨ç”¨æˆ·é…ç½®çš„å‚æ•°

### 9.7 UIæ ·å¼è§„èŒƒ

```css
/* å‚æ•°é…ç½®é¢æ¿ */
.parameter-panel {
  background: linear-gradient(to br, #f8fafc, #f1f5f9);
  border: 1px solid #e2e8f0;
  border-radius: 0.75rem;
  padding: 1rem;
  margin-bottom: 1rem;
}

/* Slider æ§ä»¶ */
.parameter-slider {
  accent-color: #3b82f6; /* blue-500 */
}

/* å‚æ•°æ ‡ç­¾ */
.parameter-label {
  font-size: 0.875rem;
  font-weight: 500;
  color: #475569; /* slate-600 */
}

/* å‚æ•°å€¼æ˜¾ç¤º */
.parameter-value {
  font-size: 0.875rem;
  font-weight: 600;
  color: #1e293b; /* slate-800 */
}

/* æç¤ºæ–‡å­— */
.parameter-hint {
  font-size: 0.75rem;
  color: #64748b; /* slate-500 */
  margin-top: 0.5rem;
}
```

### 9.8 é¢„æœŸæ•ˆæœ

1. **ç”¨æˆ·ä½“éªŒæå‡**
   - ç”¨æˆ·å¯ä»¥æ ¹æ®äº§å“ç‰¹æ€§è°ƒæ•´é¢„æµ‹å‚æ•°
   - ç›´è§‚çš„æ»‘å—æ§ä»¶ä¾¿äºå¾®è°ƒ
   - å‚æ•°æç¤ºå¸®åŠ©ç”¨æˆ·ç†è§£å„å‚æ•°å«ä¹‰

2. **é¢„æµ‹å‡†ç¡®æ€§æå‡**
   - ä¸åŒäº§å“å¯ä»¥ä½¿ç”¨ä¸åŒçš„å‚æ•°ç»„åˆ
   - å­£èŠ‚æ€§äº§å“å¯ä»¥è°ƒæ•´å­£èŠ‚å‘¨æœŸ
   - è¶‹åŠ¿æ˜æ˜¾çš„äº§å“å¯ä»¥å¢å¤§è¶‹åŠ¿ç³»æ•°

3. **æ“ä½œæµç¨‹ä¼˜åŒ–**
   - é€‰æ‹©ç®—æ³• â†’ è°ƒæ•´å‚æ•° â†’ ç‚¹å‡»é¢„æµ‹
   - å‚æ•°å˜æ›´ä¸ä¼šè‡ªåŠ¨è§¦å‘é¢„æµ‹ï¼Œå‡å°‘ä¸å¿…è¦çš„è®¡ç®—
   - ä¿æŒå½“å‰çš„ç¼“å­˜æœºåˆ¶ï¼Œä»…åœ¨å¿…è¦æ—¶é‡æ–°è·å–å†å²æ•°æ®

---

## 10. Prophet ç®—æ³•åç«¯æœåŠ¡å®ç° (2026-01-18 å®Œæˆ)

### 10.1 æ¶æ„è®¾è®¡

```
å‰ç«¯åº”ç”¨
    â”‚
    â”œâ”€â”€ forecastOperatorService.ts
    â”‚   â”œâ”€â”€ healthCheck()  â†’ GET /proxy-forecast/health
    â”‚   â””â”€â”€ forecast('prophet', input)  â†’ POST /proxy-forecast/api/v1/forecast/prophet
    â”‚
    â–¼
Vite ä»£ç†é…ç½® (vite.config.ts)
    /proxy-forecast â†’ http://localhost:8000
    â”‚
    â–¼
Python FastAPI åç«¯æœåŠ¡ (backend/)
    â”œâ”€â”€ app/main.py              # FastAPI åº”ç”¨å…¥å£
    â”œâ”€â”€ app/models.py            # Pydantic æ•°æ®æ¨¡å‹
    â””â”€â”€ app/prophet_service.py   # Prophet é¢„æµ‹æ ¸å¿ƒé€»è¾‘
```

### 10.2 åç«¯æœåŠ¡å®ç°

#### 10.2.1 ç›®å½•ç»“æ„

```
backend/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ __init__.py          # åŒ…åˆå§‹åŒ–
â”‚   â”œâ”€â”€ main.py              # FastAPI åº”ç”¨å…¥å£
â”‚   â”œâ”€â”€ models.py            # Pydantic æ•°æ®æ¨¡å‹
â”‚   â””â”€â”€ prophet_service.py   # Prophet é¢„æµ‹æœåŠ¡
â”œâ”€â”€ venv/                    # Python è™šæ‹Ÿç¯å¢ƒ
â”œâ”€â”€ requirements.txt         # Python ä¾èµ–
â”œâ”€â”€ run.py                  # å¯åŠ¨è„šæœ¬
â””â”€â”€ README.md               # ä½¿ç”¨æ–‡æ¡£
```

#### 10.2.2 ä¾èµ–æ¸…å• (requirements.txt)

```txt
# Web Framework
fastapi==0.109.0
uvicorn[standard]==0.27.0

# Prophet and Data Science
prophet==1.1.5
pandas==2.1.4
numpy==1.26.3

# API utilities
pydantic==2.5.3
python-multipart==0.0.6

# CORS support
starlette==0.35.1

# Logging
python-json-logger==2.0.7
```

#### 10.2.3 æ•°æ®æ¨¡å‹ (models.py)

```python
from pydantic import BaseModel, Field
from typing import List, Optional, Literal

class HistoricalDataPoint(BaseModel):
    """å•ä¸ªå†å²æ•°æ®ç‚¹"""
    month: str = Field(..., description="æœˆä»½ YYYY-MM")
    quantity: float = Field(..., ge=0, description="æ•°é‡å€¼")

class ProphetParameters(BaseModel):
    """Prophet ç®—æ³•å‚æ•°"""
    seasonality_mode: Literal['additive', 'multiplicative'] = 'multiplicative'
    yearly_seasonality: bool = True
    weekly_seasonality: bool = False
    changepoint_prior_scale: float = Field(0.05, ge=0.001, le=0.5)
    seasonality_prior_scale: float = Field(10.0, ge=0.01, le=10.0)
    interval_width: float = Field(0.95, ge=0.5, le=0.99)
    growth: Literal['linear', 'logistic', 'flat'] = 'linear'

class ForecastRequest(BaseModel):
    """é¢„æµ‹è¯·æ±‚"""
    product_id: str
    historical_data: List[HistoricalDataPoint]
    forecast_periods: int = Field(12, ge=1, le=36)
    parameters: Optional[ProphetParameters] = None

class ConfidenceInterval(BaseModel):
    """ç½®ä¿¡åŒºé—´"""
    lower: float
    upper: float

class ForecastMetrics(BaseModel):
    """é¢„æµ‹æŒ‡æ ‡"""
    mape: Optional[float] = None  # å¹³å‡ç»å¯¹ç™¾åˆ†æ¯”è¯¯å·®
    rmse: Optional[float] = None  # å‡æ–¹æ ¹è¯¯å·®
    mae: Optional[float] = None   # å¹³å‡ç»å¯¹è¯¯å·®

class ForecastResponse(BaseModel):
    """é¢„æµ‹å“åº”"""
    product_id: str
    algorithm: str = 'prophet'
    forecast_values: List[float]
    confidence_intervals: Optional[List[ConfidenceInterval]] = None
    metrics: Optional[ForecastMetrics] = None
    generated_at: str
```

#### 10.2.4 Prophet é¢„æµ‹æœåŠ¡ (prophet_service.py)

**å…³é”®ç‰¹æ€§**:
1. **ä¼˜é›…é™çº§**: CmdStan æœªå®‰è£…æ—¶è‡ªåŠ¨ä½¿ç”¨ Holt-Winters
2. **å‚æ•°åŒ–é…ç½®**: æ”¯æŒå®Œæ•´çš„ Prophet å‚æ•°è‡ªå®šä¹‰
3. **ç½®ä¿¡åŒºé—´**: è¿”å›é¢„æµ‹å€¼çš„ä¸Šä¸‹ç•Œ
4. **è¯„ä¼°æŒ‡æ ‡**: è¿”å› MAPEã€RMSEã€MAE

```python
class ProphetForecastService:
    def __init__(self):
        self.default_params = ProphetParameters()
        self.use_prophet = PROPHET_AVAILABLE  # æ£€æµ‹ CmdStan æ˜¯å¦å¯ç”¨

    def forecast(self, historical_data, forecast_periods, parameters):
        """
        ç”Ÿæˆé¢„æµ‹
        - å¦‚æœ Prophet/CmdStan å¯ç”¨ï¼Œä½¿ç”¨ Prophet
        - å¦åˆ™é™çº§åˆ° Holt-Winters
        """
        if self.use_prophet:
            return self._forecast_prophet(...)
        else:
            return self._forecast_holt_winters(...)

    def _forecast_prophet(self, df, forecast_periods, params):
        """ä½¿ç”¨çœŸå® Prophet è¿›è¡Œé¢„æµ‹"""
        model = Prophet(
            growth=params.growth,
            seasonality_mode=params.seasonality_mode,
            yearly_seasonality=params.yearly_seasonality,
            ...
        )
        model.fit(df)
        forecast = model.predict(future)
        return forecast_values, confidence_intervals, metrics

    def _forecast_holt_winters(self, df, forecast_periods, params):
        """Holt-Winters é™çº§å®ç°"""
        # å°† Prophet å‚æ•°æ˜ å°„åˆ° Holt-Winters
        alpha = min(0.8, 0.2 + params.changepoint_prior_scale)
        ...
        return forecast_values, confidence_intervals, metrics
```

#### 10.2.5 FastAPI åº”ç”¨ (main.py)

```python
from fastapi import FastAPI
from fastapi.middleware.cors import CORSMiddleware

app = FastAPI(
    title="Prophet Forecast Service",
    version="1.0.0"
)

# é…ç½® CORS
app.add_middleware(
    CORSMiddleware,
    allow_origins=["*"],
    allow_methods=["*"],
    allow_headers=["*"],
)

@app.get("/health")
async def health_check():
    """å¥åº·æ£€æŸ¥"""
    return {"status": "healthy", "service": "prophet-forecast"}

@app.post("/api/v1/forecast/prophet")
async def prophet_forecast(request: ForecastRequest):
    """Prophet é¢„æµ‹ç«¯ç‚¹"""
    forecast_values, confidence_intervals, metrics = \
        prophet_service.forecast(request.historical_data, ...)

    return ForecastResponse(
        product_id=request.product_id,
        forecast_values=forecast_values,
        confidence_intervals=confidence_intervals,
        metrics=metrics
    )
```

### 10.3 å‰ç«¯é›†æˆ

#### 10.3.1 ä»£ç†é…ç½® (vite.config.ts)

```typescript
export default defineConfig({
  server: {
    proxy: {
      '/proxy-forecast': {
        target: 'http://localhost:8000',
        changeOrigin: true,
        rewrite: (path) => path.replace(/^\/proxy-forecast/, ''),
      },
    },
  },
})
```

#### 10.3.2 é¢„æµ‹ç®—å­æœåŠ¡ (forecastOperatorService.ts)

```typescript
class ForecastOperatorService {
  private baseUrl = '/proxy-forecast';

  async healthCheck(): Promise<boolean> {
    try {
      const response = await httpClient.get(`${this.baseUrl}/health`);
      return response.status === 200;
    } catch {
      return false;
    }
  }

  async forecast(algorithm: ForecastAlgorithm, input: ForecastInput) {
    if (algorithm === 'prophet') {
      return this.forecastProphet(input);
    }
    // ... å…¶ä»–ç®—æ³•
  }

  private async forecastProphet(input: ProphetForecastInput) {
    try {
      const isApiAvailable = await this.healthCheck();
      if (isApiAvailable) {
        const apiInput = this.convertProphetParamsToApiFormat(input);
        const response = await httpClient.post(
          `${this.baseUrl}/api/v1/forecast/prophet`,
          apiInput
        );
        return response.data;
      }
    } catch (error) {
      console.warn('Prophet API è°ƒç”¨å¤±è´¥ï¼Œä½¿ç”¨ Holt-Winters é™çº§');
    }

    // é™çº§åˆ°å‰ç«¯ Holt-Winters
    return this.forecastLocal('holt_winters', input);
  }

  private convertProphetParamsToApiFormat(input) {
    // å‰ç«¯å‚æ•° â†’ åç«¯ API å‚æ•°æ ¼å¼è½¬æ¢
    return {
      product_id: input.product_id,
      historical_data: input.historical_data,
      forecast_periods: input.forecast_periods,
      parameters: {
        seasonality_mode: input.parameters?.seasonalityMode,
        yearly_seasonality: input.parameters?.yearlySeasonality,
        changepoint_prior_scale: input.parameters?.changepointPriorScale,
        interval_width: input.parameters?.intervalWidth,
        growth: input.parameters?.growth,
      }
    };
  }
}
```

### 10.4 éƒ¨ç½²å’Œè¿ç»´

#### 10.4.1 æœ¬åœ°å¼€å‘

```bash
# 1. åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
cd backend
python3 -m venv venv
source venv/bin/activate  # Linux/Mac

# 2. å®‰è£…ä¾èµ–
pip install -r requirements.txt

# 3. å¯åŠ¨æœåŠ¡
python run.py
# æœåŠ¡å¯åŠ¨åœ¨ http://localhost:8000

# 4. éªŒè¯æœåŠ¡
curl http://localhost:8000/health
```

#### 10.4.2 ç”Ÿäº§éƒ¨ç½²

```bash
# ä½¿ç”¨ Gunicorn + Uvicorn Workers
gunicorn app.main:app \
  -w 4 \
  -k uvicorn.workers.UvicornWorker \
  --bind 0.0.0.0:8000
```

#### 10.4.3 Docker éƒ¨ç½² (å¯é€‰)

```dockerfile
FROM python:3.11-slim

WORKDIR /app
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

COPY app/ ./app/
COPY run.py .

EXPOSE 8000
CMD ["python", "run.py"]
```

### 10.5 ç›‘æ§å’Œæ—¥å¿—

#### 10.5.1 æ—¥å¿—é…ç½®

```python
import logging

logging.basicConfig(
    level=logging.INFO,
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s'
)

logger = logging.getLogger(__name__)
logger.info("Prophet forecast generated successfully")
```

#### 10.5.2 å¥åº·æ£€æŸ¥ç«¯ç‚¹

- `GET /health` - åŸºç¡€å¥åº·æ£€æŸ¥
- `GET /api/forecast/health` - å¸¦æœåŠ¡ä¿¡æ¯çš„å¥åº·æ£€æŸ¥

### 10.6 é”™è¯¯å¤„ç†å’Œé™çº§ç­–ç•¥

#### 10.6.1 é™çº§åœºæ™¯

| åœºæ™¯ | é™çº§ç­–ç•¥ | ç”¨æˆ·æç¤º |
|------|---------|---------|
| CmdStan æœªå®‰è£… | ä½¿ç”¨ Holt-Winters | æ— ï¼ˆåç«¯è‡ªåŠ¨é™çº§ï¼‰ |
| åç«¯æœåŠ¡ä¸å¯ç”¨ | å‰ç«¯ Holt-Winters | "Prophet é¢„æµ‹æœåŠ¡æš‚æ—¶ä¸å¯ç”¨ï¼Œå·²è‡ªåŠ¨åˆ‡æ¢åˆ° Holt-Winters ç®—æ³•" |
| API è¶…æ—¶ | å‰ç«¯ Holt-Winters | åŒä¸Š |
| æ•°æ®ä¸è¶³ | ä½¿ç”¨ç®€å•æŒ‡æ•°å¹³æ»‘ | "å†å²æ•°æ®ä¸è¶³ï¼Œä½¿ç”¨ç®€å•é¢„æµ‹ç®—æ³•" |

#### 10.6.2 é™çº§æµç¨‹

```
å‰ç«¯å‘èµ· Prophet è¯·æ±‚
    â†“
healthCheck() æ£€æµ‹åç«¯å¯ç”¨æ€§
    â”œâ”€â”€ å¯ç”¨ â†’ è°ƒç”¨åç«¯ API
    â”‚   â”œâ”€â”€ æˆåŠŸ â†’ è¿”å› Prophet é¢„æµ‹ç»“æœ
    â”‚   â””â”€â”€ å¤±è´¥ â†’ å‰ç«¯ Holt-Winters é™çº§
    â””â”€â”€ ä¸å¯ç”¨ â†’ å‰ç«¯ Holt-Winters é™çº§
```

### 10.7 æ€§èƒ½ä¼˜åŒ–

1. **å¥åº·æ£€æŸ¥ç¼“å­˜**: 1åˆ†é’Ÿç¼“å­˜ï¼Œå‡å°‘é‡å¤æ£€æŸ¥
2. **è¯·æ±‚è¶…æ—¶**: é»˜è®¤ 30 ç§’ï¼Œé¿å…é•¿æ—¶é—´ç­‰å¾…
3. **å¼‚æ­¥å¤„ç†**: FastAPI åŸç”Ÿæ”¯æŒå¼‚æ­¥

### 10.8 å·²çŸ¥é™åˆ¶å’Œæœªæ¥æ”¹è¿›

#### å½“å‰é™åˆ¶

1. **CmdStan ä¾èµ–**: Prophet éœ€è¦ CmdStanï¼Œå®‰è£…å¤æ‚
2. **ç½‘ç»œè¦æ±‚**: CmdStan å®‰è£…éœ€è¦è®¿é—® GitHub
3. **å†…å­˜å ç”¨**: Prophet æ¨¡å‹è®­ç»ƒéœ€è¦è¾ƒå¤šå†…å­˜

#### æœªæ¥æ”¹è¿›

1. **Docker é•œåƒ**: é¢„è£… CmdStan çš„ Docker é•œåƒ
2. **æ‰¹é‡é¢„æµ‹**: æ”¯æŒå¤šäº§å“æ‰¹é‡é¢„æµ‹ä¼˜åŒ–
3. **æ¨¡å‹ç¼“å­˜**: ç¼“å­˜è®­ç»ƒå¥½çš„ Prophet æ¨¡å‹
4. **å‚æ•°è‡ªåŠ¨è°ƒä¼˜**: åŸºäºå†å²æ•°æ®è‡ªåŠ¨é€‰æ‹©æœ€ä¼˜å‚æ•°
