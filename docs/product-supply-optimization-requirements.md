# 产品供应优化页面 - 需求文档

## 1. 概述

产品供应优化页面是供应链管理系统的核心功能模块，提供 NPI（新产品导入）选型、EOL（产品生命周期结束）决策与供应链风险评估。该页面通过智能分析产品库存、需求趋势、供应风险等维度，为产品供应策略提供数据支持和优化建议。

## 2. 功能需求

### 2.1 页面主功能

#### FR-001: 产品供应分析面板
- **FR-001.1**: 产品选择功能
  - 提供产品下拉选择框
  - 显示格式：`产品编码-产品名称`（如：`T01-000055-北斗车载智能终端系统`）
  - 支持从所有产品列表中选择
  
- **FR-001.2**: 产品基本信息展示
  - 产品编码和名称
  - 产品生命周期状态
  - 业绩及投资回报率（ROI）

- **FR-001.3**: 供应指标卡片展示
  - 订单数量（总签约数量、已交付数量、待交付数量、完成率）
  - 供应商数量
  - 平均交货周期（天）
  - 供货稳定性评分（0-100分）
  - 当前库存水平
  - 缺货风险等级（低/中/高/严重）

- **FR-001.4**: 需求预测功能
  - 支持多种预测算法选择（Prophet、简单指数平滑、Holt线性指数平滑、Holt-Winters三重指数平滑）
  - 显示过去12个月历史实际销量
  - 显示未来12个月预测值
  - 提供预测对比图表
  - 显示预测统计信息（平均实际值、平均预测值、总预测值、置信度）

- **FR-001.5**: 订单交付分析
  - 查询产品的销售订单对象数据
  - 计算总签约数量（sum of signing_quantity）
  - 计算已交付数量（sum of shipping_quantity）
  - 计算待交付数量（总签约数量 - 已交付数量）
  - 计算完成率（已交付数量 / 总签约数量 * 100%）

- **FR-001.6**: AI建议展示
  - 显示智能建议（如："建议优先关注库存量前3的产品，及时调整供应策略"）
  - 根据需求预测提供建议（如："根据需求预测，建议提前准备高需求产品的原材料"）

### 2.2 数据加载需求

#### FR-002: 数据源要求
- **FR-002.1**: 所有数据必须从供应链知识网络API获取
- **FR-002.2**: 不支持CSV文件fallback（符合Constitution Principle 1）
- **FR-002.3**: 数据加载失败时显示错误提示，但不使用模拟数据

#### FR-003: 数据加载流程
- **FR-003.1**: 页面初始化时自动加载所有产品供应分析数据
- **FR-003.2**: 自动选择第一个产品并加载其详细信息
- **FR-003.3**: 用户切换产品时，重新加载该产品的详细信息

### 2.3 UI/UX需求

#### FR-004: 页面布局
- **FR-004.1**: 页面标题："产品供应优化"
- **FR-004.2**: 副标题："NPI 选型、EOL 决策与供应链风险评估"
- **FR-004.3**: 顶部操作栏：筛选按钮、导出按钮
- **FR-004.4**: AI建议区域（渐变背景，紫色主题）
- **FR-004.5**: 产品选择区域（下拉选择框）
- **FR-004.6**: 产品供应分析面板（白色卡片，带阴影效果）

#### FR-005: 响应式设计
- **FR-005.1**: 支持桌面端和移动端显示
- **FR-005.2**: 指标卡片采用网格布局（桌面端5列，移动端1列）
- **FR-005.3**: 算法选择器和生成按钮在同一水平线对齐

### 2.4 交互需求

#### FR-006: 用户交互
- **FR-006.1**: 点击产品下拉框可选择不同产品
- **FR-006.2**: 点击"生成需求预测"按钮触发预测计算
- **FR-006.3**: 点击订单数量卡片可打开订单交付分析模态框
- **FR-006.4**: 支持算法切换（切换后需重新生成预测）

## 3. 非功能需求

### 3.1 性能需求
- 页面初始加载时间 < 3秒
- 产品切换响应时间 < 1秒
- 预测生成时间 < 5秒

### 3.2 可靠性需求
- 数据加载失败时显示明确的错误信息
- 使用ErrorBoundary捕获组件错误
- API调用失败时优雅降级

### 3.3 可维护性需求
- 代码遵循React最佳实践
- 组件职责单一，易于测试
- 类型定义完整（TypeScript）

## 4. 业务规则

### 4.1 缺货风险等级计算规则
- **严重（critical）**: 库存覆盖月数 < 1个月
- **高（high）**: 库存覆盖月数 >= 1个月且 < 2个月
- **中（medium）**: 库存覆盖月数 >= 2个月且 < 3个月
- **低（low）**: 库存覆盖月数 >= 3个月

### 4.2 需求趋势判断规则
- **上升（increasing）**: 最近6个月订单总量 > 前6个月订单总量
- **下降（decreasing）**: 最近6个月订单总量 <= 前6个月订单总量

### 4.3 供应风险判断规则
- **高（high）**: 缺货风险等级为"严重"
- **中（medium）**: 缺货风险等级为"高"或供应商数量 < 2
- **低（low）**: 其他情况

### 4.4 订单交付计算规则
- **总签约数量**: 该产品所有销售订单的signing_quantity字段总和
- **已交付数量**: 该产品所有销售订单的shipping_quantity字段总和
- **待交付数量**: 总签约数量 - 已交付数量
- **完成率**: (已交付数量 / 总签约数量) * 100%，限制在0-100%之间

## 5. 数据需求

### 5.1 数据来源
所有数据来自供应链知识网络API（Knowledge Network ID: `d56v1l69olk4bpa66uv0`）

### 5.2 必需的数据对象类型
1. **产品（Product）** - Object Type ID: `d56v4ue9olk4bpa66v00`
2. **库存（Inventory）** - Object Type ID: `d56vcuu9olk4bpa66v3g`
3. **销售订单（Sales Order）** - Object Type ID: `d56vh169olk4bpa66v80`
4. **产品BOM（Product BOM）** - Object Type ID: `d56vqtm9olk4bpa66vfg`
5. **物料（Material）** - Object Type ID: `d56voju9olk4bpa66vcg`

### 5.3 数据字段映射
详见《技术实现方案文档》中的数据字段映射章节。

## 6. 约束条件

### 6.1 技术约束
- 必须使用React + TypeScript
- 必须使用Tailwind CSS进行样式设计
- 必须遵循Constitution Principle 1（所有数据从API获取）

### 6.2 业务约束
- 只显示状态为"销售中"或"Active"的产品
- 订单数据只统计状态为"Active"的记录
- BOM数据只使用状态为"Active"的记录

## 7. 验收标准

### 7.1 功能验收
- [ ] 页面可以正常加载并显示产品列表
- [ ] 可以选择产品并查看详细信息
- [ ] 所有指标卡片正确显示数据
- [ ] 需求预测功能正常工作
- [ ] 订单交付分析正确计算
- [ ] AI建议正确显示

### 7.2 数据验收
- [ ] 所有数据从API正确加载
- [ ] 数据字段映射正确
- [ ] 计算逻辑正确（缺货风险、需求趋势、供应风险等）

### 7.3 UI验收
- [ ] 页面布局符合设计要求
- [ ] 响应式设计正常工作
- [ ] 交互流畅，无卡顿
- [ ] 错误提示清晰明确
